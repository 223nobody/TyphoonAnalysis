"""
DeepSeek AIæœåŠ¡
æä¾›åŸºäºDeepSeek APIçš„å°é£æŠ¥å‘Šç”ŸæˆåŠŸèƒ½

ç‰¹æ€§ï¼š
- æ”¯æŒè‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- å½“APIè°ƒç”¨å¤±è´¥æ—¶ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸è¿›è¡ŒæœåŠ¡é™çº§
"""
import asyncio
import json
import logging
from typing import Dict, Optional
import httpx

from app.core.config import settings

logger = logging.getLogger(__name__)


class DeepSeekService:
    """DeepSeek AIæœåŠ¡ç±» - ä¸“æ³¨äºæ–‡æœ¬æŠ¥å‘Šç”Ÿæˆ"""

    def __init__(self):
        self.api_key = settings.AI_API_KEY  # ä½¿ç”¨ç»Ÿä¸€çš„API Key
        self.base_url = settings.AI_API_BASE_URL  # ä½¿ç”¨ç»Ÿä¸€çš„Base URL
        self.model = settings.DEEPSEEK_MODEL
        self.timeout = 120  # ä½¿ç”¨é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼ˆ120ç§’ï¼‰
        self.max_tokens = 3000  # ä½¿ç”¨é…ç½®çš„æœ€å¤§tokenæ•°
        self.max_retries = 3  # æœ€å¤§é‡è¯•æ¬¡æ•°
        self.retry_delay = 2  # é‡è¯•é—´éš”ï¼ˆç§’ï¼‰

    async def _make_api_request(
        self,
        payload: Dict,
        headers: Dict
    ) -> Dict:
        """
        å‘é€APIè¯·æ±‚ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶

        Args:
            payload: è¯·æ±‚ä½“
            headers: è¯·æ±‚å¤´

        Returns:
            Dict: APIå“åº”ç»“æœ

        Raises:
            Exception: æ‰€æœ‰é‡è¯•å¤±è´¥åæŠ›å‡ºå¼‚å¸¸
        """
        endpoint = f"{self.base_url}/chat/completions"
        last_error = None

        # è®°å½•é…ç½®ä¿¡æ¯ï¼ˆç”¨äºè¯Šæ–­ï¼‰
        logger.info(f"DeepSeek APIé…ç½® - Base URL: {self.base_url}, Model: {self.model}")

        for attempt in range(1, self.max_retries + 1):
            try:
                logger.info(f"DeepSeek APIè¯·æ±‚ - ç¬¬{attempt}æ¬¡å°è¯•")
                logger.info(f"  - è¯·æ±‚URL: {endpoint}")
                logger.info(f"  - è¯·æ±‚æ¨¡å‹: {payload.get('model')}")
                logger.info(f"  - è¶…æ—¶è®¾ç½®: {self.timeout}ç§’")

                async with httpx.AsyncClient(timeout=self.timeout) as client:
                    response = await client.post(
                        endpoint,
                        json=payload,
                        headers=headers
                    )

                    # ç¡®ä¿å“åº”ä½¿ç”¨ UTF-8 ç¼–ç 
                    response.encoding = "utf-8"

                    # è®°å½•å“åº”çŠ¶æ€
                    logger.info(f"DeepSeek APIå“åº” - çŠ¶æ€ç : {response.status_code}")

                    # å…¶ä»–é”™è¯¯ç›´æ¥æŠ›å‡º
                    response.raise_for_status()

                    # æˆåŠŸè¿”å›ç»“æœ
                    result = response.json()
                    logger.info(f"DeepSeek APIè¯·æ±‚æˆåŠŸ - ç¬¬{attempt}æ¬¡å°è¯•")
                    logger.info(f"  - å“åº”æ•°æ®: {json.dumps(result, ensure_ascii=False)[:200]}...")
                    return result

            except httpx.TimeoutException as e:
                last_error = e
                logger.warning(f"DeepSeek APIè¶…æ—¶ - ç¬¬{attempt}æ¬¡å°è¯•")
                logger.warning(f"  - è¶…æ—¶æ—¶é—´: {self.timeout}ç§’")
                logger.warning(f"  - é”™è¯¯è¯¦æƒ…: {e}")
                if attempt < self.max_retries:
                    wait_time = self.retry_delay * attempt
                    logger.info(f"ç­‰å¾…{wait_time}ç§’åé‡è¯•...")
                    await asyncio.sleep(wait_time)

            except httpx.HTTPStatusError as e:
                last_error = e
                logger.error(f"DeepSeek API HTTPé”™è¯¯ - ç¬¬{attempt}æ¬¡å°è¯•")
                logger.error(f"  - çŠ¶æ€ç : {e.response.status_code}")
                logger.error(f"  - é”™è¯¯ä¿¡æ¯: {e}")

                # å°è¯•è·å–å“åº”å†…å®¹
                try:
                    error_content = e.response.text
                    logger.error(f"  - å“åº”å†…å®¹: {error_content[:500]}")
                except:
                    pass


            except Exception as e:
                last_error = e
                logger.error(f"DeepSeek APIè¯·æ±‚å¼‚å¸¸ - ç¬¬{attempt}æ¬¡å°è¯•")
                logger.error(f"  - å¼‚å¸¸ç±»å‹: {type(e).__name__}")
                logger.error(f"  - å¼‚å¸¸ä¿¡æ¯: {e}")
                if attempt < self.max_retries:
                    wait_time = self.retry_delay * attempt
                    await asyncio.sleep(wait_time)

        # æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥
        logger.error("DeepSeek APIæ‰€æœ‰é‡è¯•å‡å¤±è´¥")
        logger.error(f"  - æœ€åé”™è¯¯: {last_error}")
        raise last_error or Exception("DeepSeek APIè¯·æ±‚å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")

    # ç« èŠ‚å¹¶å‘ç”Ÿæˆæ‰©å±• - å¼€å§‹
    async def _generate_single_chapter(
        self,
        chapter_name: str,
        chapter_prompt: str
    ) -> Dict:
        """
        ç”Ÿæˆå•ä¸ªç« èŠ‚å†…å®¹ï¼ˆæ”¯æŒé‡è¯•æœºåˆ¶ï¼‰

        Args:
            chapter_name: ç« èŠ‚åç§°
            chapter_prompt: ç« èŠ‚æç¤ºè¯

        Returns:
            Dict: ç« èŠ‚ç”Ÿæˆç»“æœï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                - success: bool - æ˜¯å¦æˆåŠŸ
                - content: str - ç« èŠ‚å†…å®¹
                - error: str - é”™è¯¯ä¿¡æ¯ï¼ˆä»…åœ¨å¤±è´¥æ—¶ï¼‰
        """
        logger.info(f"å¼€å§‹ç”Ÿæˆç« èŠ‚ - ç« èŠ‚åç§°: {chapter_name}")

        try:
            payload = {
                "model": self.model,
                "messages": [
                    {
                        "role": "system",
                        "content": "ä½ æ˜¯æ°”è±¡åˆ†æä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆè¯¦å°½ä¸“ä¸šçš„å°é£æŠ¥å‘Šã€‚è¯·ä½¿ç”¨Markdownæ ¼å¼è¾“å‡ºï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆ##ï¼‰ã€åˆ—è¡¨ï¼ˆ-ï¼‰ã€åŠ ç²—ï¼ˆ**ï¼‰ç­‰æ ¼å¼ã€‚"
                    },
                    {
                        "role": "user",
                        "content": chapter_prompt
                    }
                ],
                "stream": False,
                "temperature": 0.5,
                "max_tokens": self.max_tokens,
                "frequency_penalty": 0.3,
                "response_format": {"type": "text"}
            }

            headers = {
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json"
            }

            # ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚
            result = await self._make_api_request(payload, headers)

            # æå–ç”Ÿæˆçš„ç« èŠ‚å†…å®¹
            chapter_content = result.get("choices", [{}])[0].get("message", {}).get("content", "")

            logger.info(f"ç« èŠ‚ç”ŸæˆæˆåŠŸ - ç« èŠ‚åç§°: {chapter_name}, å†…å®¹é•¿åº¦: {len(chapter_content)}")

            return {
                "success": True,
                "content": chapter_content.strip(),
                "error": None
            }

        except Exception as e:
            logger.error(f"ç« èŠ‚ç”Ÿæˆå¤±è´¥ - ç« èŠ‚åç§°: {chapter_name}")
            logger.error(f"  - é”™è¯¯ç±»å‹: {type(e).__name__}")
            logger.error(f"  - é”™è¯¯è¯¦æƒ…: {str(e)}")

            return {
                "success": False,
                "content": "",
                "error": str(e)
            }

    def _build_chapter_prompt(
        self,
        report_type: str,
        chapter_name: str,
        typhoon_id: str,
        typhoon_name: str,
        data: Dict
    ) -> str:
        """
        æ„å»ºå•ä¸ªç« èŠ‚çš„æç¤ºè¯

        Args:
            report_type: æŠ¥å‘Šç±»å‹ï¼ˆcomprehensive/impactï¼‰
            chapter_name: ç« èŠ‚åç§°
            typhoon_id: å°é£ç¼–å·
            typhoon_name: å°é£åç§°
            data: æ•°æ®ï¼ˆå†å²æ•°æ®æˆ–é¢„æµ‹æ•°æ®ï¼‰

        Returns:
            str: ç« èŠ‚æç¤ºè¯
        """
        # ç»¼åˆåˆ†ææŠ¥å‘Šç« èŠ‚
        if report_type == "comprehensive":
            if chapter_name == "å°é£ç”Ÿå‘½å‘¨æœŸæ¦‚å†µ":
                return f"""åŸºäºå†å²è·¯å¾„æ•°æ®ç”Ÿæˆå°é£ç»¼åˆåˆ†ææŠ¥å‘Šçš„ç¬¬ä¸€ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²è·¯å¾„æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## ä¸€ã€å°é£ç”Ÿå‘½å‘¨æœŸæ¦‚å†µ

---

### 1.1 ğŸ• ç”Ÿå‘½å‘¨æœŸæ—¶é—´çº¿

> **å…³é”®æ—¶é—´èŠ‚ç‚¹**

- **ç”Ÿæˆæ—¶é—´**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mmï¼ˆç»çº¬åº¦ä½ç½®ï¼‰
- **æ¶ˆæ•£æ—¶é—´**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mmï¼ˆç»çº¬åº¦ä½ç½®ï¼‰
- **æŒç»­æ—¶é•¿**ï¼šXå¤©Xå°æ—¶ï¼ˆæ€»è®¡XXå°æ—¶ï¼‰

### 1.2 ğŸ“ å½±å“åŒºåŸŸèŒƒå›´

> **åœ°ç†è¦†ç›–èŒƒå›´**

- **ä¸»è¦å½±å“åŒºåŸŸ**ï¼šåˆ—å‡ºçœä»½/åœ°åŒº
- **å½±å“åŠå¾„**ï¼šçº¦XX~XX km
- **è¦†ç›–é¢ç§¯**ï¼šçº¦XXä¸‡å¹³æ–¹å…¬é‡Œ
- **æœ€å¤§å½±å“æ—¶æ®µ**ï¼šYYYYå¹´MMæœˆDDæ—¥è‡³DDæ—¥

### 1.3 ğŸ“Š å°é£ç­‰çº§æ¼”å˜

> **å¼ºåº¦å˜åŒ–å†ç¨‹**

| æ—¶é—´æ®µ | å°é£ç­‰çº§ | ä¸­å¿ƒæ°”å‹ | æœ€å¤§é£é€Ÿ |
|--------|----------|----------|----------|
| åˆæœŸ | *çƒ­å¸¦ä½å‹* | XXX hPa | XX m/s |
| å‘å±•æœŸ | *å°é£* | XXX hPa | XX m/s |
| å·…å³°æœŸ | *å¼ºå°é£* | XXX hPa | XX m/s |
| è¡°å‡æœŸ | *çƒ­å¸¦é£æš´* | XXX hPa | XX m/s |

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šå°é£åœ¨XXæ—¶æ®µè¾¾åˆ°æœ€å¼ºï¼Œç­‰çº§ä¸º*XX*ï¼ŒæŒç»­æ—¶é—´çº¦XXå°æ—¶ã€‚

### 1.4 ğŸ”„ ç”Ÿå‘½å‘¨æœŸç‰¹å¾

**å„é˜¶æ®µç‰¹å¾åˆ†æ**ï¼š

1. **ç”Ÿæˆé˜¶æ®µ**ï¼ˆXå¤©ï¼‰
    - åˆå§‹ä½ç½®åŠç¯å¢ƒæ¡ä»¶
    - å‘å±•é€Ÿåº¦åŠå½±å“å› ç´ 

2. **å‘å±•é˜¶æ®µ**ï¼ˆXå¤©ï¼‰
    - å¼ºåº¦å¢å¼ºè§„å¾‹
    - è·¯å¾„è°ƒæ•´ç‰¹å¾

3. **æˆç†Ÿé˜¶æ®µ**ï¼ˆXå¤©ï¼‰
    - æœ€å¼ºæ—¶æ®µè¡¨ç°
    - å½±å“èŒƒå›´æ‰©å¤§æƒ…å†µ

4. **è¡°å‡é˜¶æ®µ**ï¼ˆXå¤©ï¼‰
    - å‡å¼±é€Ÿåº¦åŠåŸå› 
    - æ®‹ä½™å½±å“è¯„ä¼°

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - æ—¶é—´ï¼š`YYYYå¹´MMæœˆDDæ—¥ HH:mm`
   - ç»çº¬åº¦ï¼š`XX.XXÂ°N/S, XX.XXÂ°E/W`
   - é£é€Ÿï¼š`XX m/sï¼ˆXXçº§ï¼‰`æˆ–èŒƒå›´`XX~XX m/s`
   - æ°”å‹ï¼š`XXX hPa`æˆ–èŒƒå›´`XXX~XXX hPa`
   - è·ç¦»ï¼š`XX km`æˆ–èŒƒå›´`XX~XX km`
   - ç™¾åˆ†æ¯”ï¼š`XX%`
   - æ¸©åº¦ï¼š`XXÂ°C`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - æ—¶é—´èŠ‚ç‚¹ä½¿ç”¨ `ğŸ•` å›¾æ ‡
   - ä½ç½®ä¿¡æ¯ä½¿ç”¨ `ğŸ“` å›¾æ ‡
   - æ•°æ®ç»Ÿè®¡ä½¿ç”¨ `ğŸ“Š` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡
   - è­¦å‘Šä¿¡æ¯ä½¿ç”¨ `âš ï¸` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å°é£ç­‰çº§ä½¿ç”¨ `*æ–œä½“*`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "è·¯å¾„ç‰¹å¾åˆ†æ":
                return f"""åŸºäºå†å²è·¯å¾„æ•°æ®ç”Ÿæˆå°é£ç»¼åˆåˆ†ææŠ¥å‘Šçš„ç¬¬äºŒç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²è·¯å¾„æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## äºŒã€è·¯å¾„ç‰¹å¾åˆ†æ

---

### 2.1 ğŸ—ºï¸ ç§»åŠ¨è·¯å¾„æè¿°

> **è·¯å¾„å…³é”®èŠ‚ç‚¹**

**å®Œæ•´è·¯å¾„è½¨è¿¹**ï¼š

1. **èµ·ç‚¹**ï¼šXX.XXÂ°N, XX.XXÂ°Eï¼ˆåœ°ç†ä½ç½®æè¿°ï¼‰
2. **å…³é”®è½¬æŠ˜ç‚¹**ï¼šXX.XXÂ°N, XX.XXÂ°Eï¼ˆè½¬æŠ˜æ—¶é—´åŠåŸå› ï¼‰
3. **ç™»é™†ç‚¹**ï¼ˆå¦‚æœ‰ï¼‰ï¼šXX.XXÂ°N, XX.XXÂ°Eï¼ˆç™»é™†æ—¶é—´åŠåœ°ç‚¹ï¼‰
4. **ç»ˆç‚¹**ï¼šXX.XXÂ°N, XX.XXÂ°Eï¼ˆæ¶ˆæ•£ä½ç½®ï¼‰

**ğŸ“Œ è·¯å¾„æ€»ç»“**ï¼šå°é£æ•´ä½“å‘ˆXXæ–¹å‘ç§»åŠ¨ï¼Œè·¯å¾„é•¿åº¦çº¦XX kmï¼Œä¸»è¦å½±å“XXåŒºåŸŸã€‚

### 2.2 âš¡ ç§»åŠ¨é€Ÿåº¦åˆ†æ

> **é€Ÿåº¦å˜åŒ–è§„å¾‹**

| é˜¶æ®µ | æ—¶é—´æ®µ | å¹³å‡é€Ÿåº¦ | é€Ÿåº¦ç‰¹å¾ |
|------|--------|----------|----------|
| åˆæœŸ | XXæ—¥-XXæ—¥ | XX km/h | ç¼“æ…¢ç§»åŠ¨ |
| åŠ é€ŸæœŸ | XXæ—¥-XXæ—¥ | XX~XX km/h | å¿«é€Ÿç§»åŠ¨ |
| å‡é€ŸæœŸ | XXæ—¥-XXæ—¥ | XX km/h | é€æ¸å‡æ…¢ |

**é€Ÿåº¦å˜åŒ–åŸå› **ï¼š
- å‰¯çƒ­å¸¦é«˜å‹å½±å“
- è¥¿é£æ§½å¼•å¯¼ä½œç”¨
- åœ°å½¢æ‘©æ“¦æ•ˆåº”

### 2.3 ğŸ”„ è·¯å¾„è½¬æŠ˜ç‚¹åˆ†æ

**ä¸»è¦è½¬æŠ˜ç‚¹è¯¦æƒ…**ï¼š

1. **ç¬¬ä¸€è½¬æŠ˜ç‚¹**ï¼ˆYYYYå¹´MMæœˆDDæ—¥ HH:mmï¼‰
    - ä½ç½®ï¼šXX.XXÂ°N, XX.XXÂ°E
    - è½¬æŠ˜è§’åº¦ï¼šçº¦XXÂ°
    - è½¬æŠ˜åŸå› ï¼šå‰¯çƒ­å¸¦é«˜å‹å‡å¼±/è¥¿é£æ§½å½±å“

2. **ç¬¬äºŒè½¬æŠ˜ç‚¹**ï¼ˆå¦‚æœ‰ï¼‰
    - ä½ç½®ï¼šXX.XXÂ°N, XX.XXÂ°E
    - è½¬æŠ˜è§’åº¦ï¼šçº¦XXÂ°
    - è½¬æŠ˜åŸå› ï¼šåœ°å½¢å½±å“/ç¯æµè°ƒæ•´

### 2.4 ğŸ“Š è·¯å¾„ç‰¹å¾è¯„ä¼°

**å¼‚å¸¸ç‰¹å¾è¯†åˆ«**ï¼š

- âš ï¸ **è·¯å¾„å¼‚å¸¸**ï¼šæ˜¯å¦å­˜åœ¨çªç„¶è½¬å‘ã€åœæ»ã€å›æ—‹ç­‰å¼‚å¸¸è¡Œä¸º
- **å†å²å¯¹æ¯”**ï¼šä¸å†å²åŒæœŸå°é£è·¯å¾„çš„ç›¸ä¼¼åº¦çº¦XX%
- **é¢„æµ‹éš¾åº¦**ï¼šè·¯å¾„å¤æ‚åº¦è¯„çº§ï¼ˆé«˜/ä¸­/ä½ï¼‰

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šæœ¬æ¬¡å°é£è·¯å¾„XXï¼ˆè§„å¾‹/å¼‚å¸¸ï¼‰ï¼Œä¸»è¦å—XXç³»ç»Ÿå½±å“ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - æ—¶é—´ï¼š`YYYYå¹´MMæœˆDDæ—¥ HH:mm`
   - ç»çº¬åº¦ï¼š`XX.XXÂ°N/S, XX.XXÂ°E/W`
   - é€Ÿåº¦ï¼š`XX km/h`æˆ–èŒƒå›´`XX~XX km/h`
   - è·ç¦»ï¼š`XX km`
   - è§’åº¦ï¼š`XXÂ°`
   - ç™¾åˆ†æ¯”ï¼š`XX%`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - è·¯å¾„ä¿¡æ¯ä½¿ç”¨ `ğŸ—ºï¸` å›¾æ ‡
   - é€Ÿåº¦ä¿¡æ¯ä½¿ç”¨ `âš¡` å›¾æ ‡
   - è½¬æŠ˜ç‚¹ä½¿ç”¨ `ğŸ”„` å›¾æ ‡
   - æ•°æ®ç»Ÿè®¡ä½¿ç”¨ `ğŸ“Š` å›¾æ ‡
   - è­¦å‘Šä¿¡æ¯ä½¿ç”¨ `âš ï¸` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "å¼ºåº¦æ¼”å˜åˆ†æ":
                return f"""åŸºäºå†å²è·¯å¾„æ•°æ®ç”Ÿæˆå°é£ç»¼åˆåˆ†ææŠ¥å‘Šçš„ç¬¬ä¸‰ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²è·¯å¾„æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## ä¸‰ã€å¼ºåº¦æ¼”å˜åˆ†æ

---

### 3.1 ğŸ’ª æœ€å¤§å¼ºåº¦è¯„ä¼°

> **å·…å³°æ—¶åˆ»æ•°æ®**

- **æœ€å¤§é£é€Ÿ**ï¼š**XX m/sï¼ˆXXçº§ï¼‰**
- **æœ€ä½æ°”å‹**ï¼š**XXX hPa**
- **å‡ºç°æ—¶é—´**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mm
- **å‡ºç°ä½ç½®**ï¼šXX.XXÂ°N, XX.XXÂ°Eï¼ˆåœ°ç†ä½ç½®ï¼‰
- **å°é£ç­‰çº§**ï¼š*è¶…å¼ºå°é£/å¼ºå°é£/å°é£*

**ğŸ“Œ å¼ºåº¦è¯„çº§**ï¼šæœ¬æ¬¡å°é£æœ€å¤§å¼ºåº¦åœ¨å†å²åŒæœŸå°é£ä¸­æ’åå‰XX%ã€‚

### 3.2 ğŸ“ˆ å¼ºåº¦å˜åŒ–è¶‹åŠ¿

> **å®Œæ•´æ¼”å˜è¿‡ç¨‹**

| é˜¶æ®µ | æ—¶é—´æ®µ | é£é€ŸèŒƒå›´ | æ°”å‹èŒƒå›´ | ç­‰çº§å˜åŒ– |
|------|--------|----------|----------|----------|
| ç”ŸæˆæœŸ | XXæ—¥-XXæ—¥ | XX~XX m/s | XXX~XXX hPa | *çƒ­å¸¦ä½å‹* |
| å¢å¼ºæœŸ | XXæ—¥-XXæ—¥ | XX~XX m/s | XXX~XXX hPa | *çƒ­å¸¦é£æš´â†’å°é£* |
| å·…å³°æœŸ | XXæ—¥-XXæ—¥ | XX~XX m/s | XXX~XXX hPa | *å¼ºå°é£* |
| å‡å¼±æœŸ | XXæ—¥-XXæ—¥ | XX~XX m/s | XXX~XXX hPa | *å°é£â†’çƒ­å¸¦é£æš´* |

**å¼ºåº¦å˜åŒ–ç‰¹å¾**ï¼š

1. **å¢å¼ºé˜¶æ®µ**ï¼ˆæŒç»­XXå°æ—¶ï¼‰
    - å¢å¼ºé€Ÿåº¦ï¼šXX m/s/å¤©
    - ä¸»è¦å½±å“å› ç´ ï¼šæµ·æ¸©XXÂ°Cã€æ°´æ±½å……è¶³

2. **ç»´æŒé˜¶æ®µ**ï¼ˆæŒç»­XXå°æ—¶ï¼‰
    - å¼ºåº¦æ³¢åŠ¨èŒƒå›´ï¼šÂ±X m/s
    - ç»´æŒåŸå› ï¼šç¯å¢ƒæ¡ä»¶ç¨³å®š

3. **å‡å¼±é˜¶æ®µ**ï¼ˆæŒç»­XXå°æ—¶ï¼‰
    - å‡å¼±é€Ÿåº¦ï¼šXX m/s/å¤©
    - ä¸»è¦åŸå› ï¼šç™»é™†/å†·ç©ºæ°”/æµ·æ¸©ä¸‹é™

### 3.3 ğŸŒ¡ï¸ æ°”å‹æ¼”å˜è§„å¾‹

> **ä¸­å¿ƒæ°”å‹å˜åŒ–**

**æ°”å‹å˜åŒ–æ›²çº¿ç‰¹å¾**ï¼š
- **æœ€ä½æ°”å‹**ï¼šXXX hPaï¼ˆYYYYå¹´MMæœˆDDæ—¥ï¼‰
- **æ°”å‹é™å¹…**ï¼šä»XXX hPaé™è‡³XXX hPaï¼Œé™å¹…XX hPa
- **é™å‹é€Ÿåº¦**ï¼šæœ€å¿«XX hPa/12hï¼ˆå¿«é€Ÿå¢å¼ºæœŸï¼‰

**å½±å“å› ç´ åˆ†æ**ï¼š
- æµ·è¡¨æ¸©åº¦ï¼šXX~XXÂ°Cï¼ˆé€‚å®œ/åé«˜/åä½ï¼‰
- å‚ç›´é£åˆ‡å˜ï¼šXX m/sï¼ˆå¼±/ä¸­ç­‰/å¼ºï¼‰
- é«˜ç©ºè¾æ•£æ¡ä»¶ï¼šè‰¯å¥½/ä¸€èˆ¬/è¾ƒå·®

### 3.4 ğŸ’¨ é£é€Ÿæ¼”å˜è§„å¾‹

> **æœ€å¤§é£é€Ÿå˜åŒ–**

**é£é€Ÿå˜åŒ–ç‰¹å¾**ï¼š
- **æœ€å¤§é£é€Ÿ**ï¼šXX m/sï¼ˆXXçº§ï¼‰
- **é£é€Ÿå¢å¹…**ï¼šä»XX m/så¢è‡³XX m/sï¼Œå¢å¹…XX m/s
- **å¢é€Ÿæœ€å¿«æ—¶æ®µ**ï¼šYYYYå¹´MMæœˆDDæ—¥è‡³DDæ—¥ï¼ˆXX m/s/å¤©ï¼‰

**é£é€Ÿåˆ†å¸ƒç‰¹å¾**ï¼š
- 7çº§é£åœˆåŠå¾„ï¼šXX~XX km
- 10çº§é£åœˆåŠå¾„ï¼šXX~XX km
- 12çº§é£åœˆåŠå¾„ï¼šXX~XX km

### 3.5 ğŸŒ ç¯å¢ƒå› ç´ å½±å“

**å…³é”®ç¯å¢ƒè¦ç´ **ï¼š

1. **æµ·æ´‹æ¡ä»¶**
    - æµ·è¡¨æ¸©åº¦ï¼šXX~XXÂ°C
    - æµ·æ´‹çƒ­å«é‡ï¼šé«˜/ä¸­/ä½

2. **å¤§æ°”ç¯æµ**
    - å‰¯çƒ­å¸¦é«˜å‹ï¼šå¼ºåº¦XXã€ä½ç½®XX
    - è¥¿é£æ§½ï¼šå½±å“ç¨‹åº¦XX

3. **å…¶ä»–å› ç´ **
    - å‚ç›´é£åˆ‡å˜ï¼šXX m/s
    - æ°´æ±½è¾“é€ï¼šå……è¶³/ä¸€èˆ¬/ä¸è¶³

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šå°é£å¼ºåº¦å˜åŒ–ä¸»è¦å—XXå› ç´ æ§åˆ¶ï¼ŒXXé˜¶æ®µå¢å¼ºæœ€å¿«ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - æ—¶é—´ï¼š`YYYYå¹´MMæœˆDDæ—¥ HH:mm`
   - é£é€Ÿï¼š`XX m/sï¼ˆXXçº§ï¼‰`æˆ–èŒƒå›´`XX~XX m/s`
   - æ°”å‹ï¼š`XXX hPa`æˆ–èŒƒå›´`XXX~XXX hPa`
   - æ¸©åº¦ï¼š`XXÂ°C`æˆ–èŒƒå›´`XX~XXÂ°C`
   - è·ç¦»ï¼š`XX km`æˆ–èŒƒå›´`XX~XX km`
   - é€Ÿåº¦å˜åŒ–ï¼š`XX m/s/å¤©`æˆ–`XX hPa/12h`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - å¼ºåº¦ä¿¡æ¯ä½¿ç”¨ `ğŸ’ª` å›¾æ ‡
   - è¶‹åŠ¿åˆ†æä½¿ç”¨ `ğŸ“ˆ` å›¾æ ‡
   - æ¸©åº¦ä¿¡æ¯ä½¿ç”¨ `ğŸŒ¡ï¸` å›¾æ ‡
   - é£é€Ÿä¿¡æ¯ä½¿ç”¨ `ğŸ’¨` å›¾æ ‡
   - ç¯å¢ƒå› ç´ ä½¿ç”¨ `ğŸŒ` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å°é£ç­‰çº§ä½¿ç”¨ `*æ–œä½“*`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "å†å²å½±å“è¯„ä¼°":
                return f"""åŸºäºå†å²è·¯å¾„æ•°æ®ç”Ÿæˆå°é£ç»¼åˆåˆ†ææŠ¥å‘Šçš„ç¬¬å››ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²è·¯å¾„æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## å››ã€å†å²å½±å“è¯„ä¼°

---

### 4.1 ğŸŒ å½±å“åœ°åŒºåˆ†æ

> **ä¸»è¦å—ç¾åŒºåŸŸ**

| åœ°åŒº | å½±å“ç¨‹åº¦ | å½±å“æ—¶æ®µ | ä¸»è¦ç¾å®³ |
|------|----------|----------|----------|
| XXçœXXå¸‚ | **ä¸¥é‡** | XXæ—¥-XXæ—¥ | é£ç¾ã€é›¨ç¾ |
| XXçœXXå¸‚ | **è¾ƒé‡** | XXæ—¥-XXæ—¥ | é›¨ç¾ã€æ½®ç¾ |
| XXçœXXå¸‚ | **ä¸€èˆ¬** | XXæ—¥-XXæ—¥ | é£ç¾ |

**å½±å“èŒƒå›´ç»Ÿè®¡**ï¼š
- å—å½±å“çœä»½ï¼šXXä¸ª
- å—å½±å“åŸå¸‚ï¼šXXä¸ª
- å—ç¾äººå£ï¼šçº¦XXä¸‡äºº
- è½¬ç§»å®‰ç½®äººå£ï¼šçº¦XXä¸‡äºº

### 4.2 âš ï¸ ç¾å®³ç±»å‹è¯„ä¼°

> **ä¸‰å¤§ä¸»è¦ç¾å®³**

**1. é£ç¾å½±å“**
- **æœ€å¤§é£åŠ›**ï¼šXXçº§ï¼ˆXX m/sï¼‰
- **æŒç»­æ—¶é—´**ï¼šXXå°æ—¶
- **å½±å“èŒƒå›´**ï¼šXX kmåŠå¾„
- **ä¸»è¦æŸå¤±**ï¼šæˆ¿å±‹å—æŸXXé—´ã€æ ‘æœ¨å€’ä¼XXæ£µ

**2. é›¨ç¾å½±å“**
- **æœ€å¤§é™é›¨é‡**ï¼šXXX mmï¼ˆXXå¸‚XXåŒºï¼‰
- **ç´¯è®¡é™é›¨**ï¼šXX~XXX mm
- **é™é›¨æ—¶é•¿**ï¼šXXå°æ—¶
- **ä¸»è¦æŸå¤±**ï¼šå†œç”°å—æ·¹XXä¸‡äº©ã€é“è·¯ä¸­æ–­XXæ¡

**3. æ½®ç¾å½±å“**
- **æœ€å¤§é£æš´æ½®**ï¼šX.Xç±³
- **æµ·æµªé«˜åº¦**ï¼šX~Xç±³
- **å½±å“æµ·å²¸çº¿**ï¼šçº¦XX km
- **ä¸»è¦æŸå¤±**ï¼šæµ·å ¤æŸæ¯XXå¤„ã€æ¸”èˆ¹å—æŸXXè‰˜

### 4.3 ğŸ’° æŸå¤±è¯„ä¼°

> **ç»æµç¤¾ä¼šå½±å“**

**ç›´æ¥ç»æµæŸå¤±**ï¼š
- **æ€»æŸå¤±**ï¼šçº¦**XXäº¿å…ƒ**
- **å†œä¸šæŸå¤±**ï¼šXXäº¿å…ƒï¼ˆå†œä½œç‰©XXä¸‡äº©ï¼‰
- **å·¥ä¸šæŸå¤±**ï¼šXXäº¿å…ƒï¼ˆåœå·¥ä¼ä¸šXXå®¶ï¼‰
- **åŸºç¡€è®¾æ–½æŸå¤±**ï¼šXXäº¿å…ƒï¼ˆé“è·¯ã€ç”µåŠ›ã€é€šä¿¡ç­‰ï¼‰
- **å±…æ°‘è´¢äº§æŸå¤±**ï¼šXXäº¿å…ƒï¼ˆæˆ¿å±‹ã€è½¦è¾†ç­‰ï¼‰

**äººå‘˜ä¼¤äº¡æƒ…å†µ**ï¼š
- æ­»äº¡äººæ•°ï¼šXXäºº
- å¤±è¸ªäººæ•°ï¼šXXäºº
- å—ä¼¤äººæ•°ï¼šXXäºº

âš ï¸ **æ³¨**ï¼šå¦‚æ— å…·ä½“æ•°æ®ï¼Œè¯´æ˜"æš‚æ— è¯¦ç»†ç»Ÿè®¡æ•°æ®"ã€‚

### 4.4 ğŸ“š å†å²æ„ä¹‰

**å†å²åœ°ä½è¯„ä¼°**ï¼š

1. **å¼ºåº¦æ’å**
    - åœ¨è¿‘XXå¹´åŒæœŸå°é£ä¸­æ’åç¬¬XXä½
    - ç™»é™†å¼ºåº¦ä¸ºå†å²ç¬¬XXå¼º

2. **å½±å“èŒƒå›´**
    - å½±å“èŒƒå›´ä¸ºè¿‘XXå¹´æœ€å¹¿/è¾ƒå¹¿/ä¸€èˆ¬
    - æŒç»­æ—¶é—´ä¸ºå†å²ç¬¬XXé•¿

3. **å‚è€ƒä»·å€¼**
    - è·¯å¾„ç‰¹å¾ï¼šå…¸å‹/ç½•è§ï¼Œå¯ä½œä¸ºXXç±»å‹å°é£å‚è€ƒ
    - å¼ºåº¦æ¼”å˜ï¼šå…·æœ‰XXç‰¹å¾ï¼Œå€¼å¾—æ·±å…¥ç ”ç©¶
    - é˜²ç¾ç»éªŒï¼šä¸ºæœªæ¥ç±»ä¼¼å°é£é˜²å¾¡æä¾›XXå€Ÿé‰´

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šæœ¬æ¬¡å°é£åœ¨XXæ–¹é¢å…·æœ‰æ˜¾è‘—ç‰¹å¾ï¼Œå¯¹XXåœ°åŒºé€ æˆXXå½±å“ï¼Œä¸ºå†å²ä¸ŠXXå°é£ä¹‹ä¸€ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - å½±å“ç¨‹åº¦ï¼š`**ä¸¥é‡**`ã€`**è¾ƒé‡**`ã€`**ä¸€èˆ¬**`
   - ç»æµæŸå¤±ï¼š`XXäº¿å…ƒ`
   - äººå‘˜æ•°é‡ï¼š`XXäºº`æˆ–`XXä¸‡äºº`
   - é¢ç§¯ï¼š`XXä¸‡äº©`æˆ–`XXä¸‡å¹³æ–¹å…¬é‡Œ`
   - é™é›¨é‡ï¼š`XXX mm`
   - é£æš´æ½®ï¼š`X.Xç±³`
   - è·ç¦»ï¼š`XX km`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - åœ°åŒºä¿¡æ¯ä½¿ç”¨ `ğŸŒ` å›¾æ ‡
   - ç¾å®³è­¦å‘Šä½¿ç”¨ `âš ï¸` å›¾æ ‡
   - ç»æµæŸå¤±ä½¿ç”¨ `ğŸ’°` å›¾æ ‡
   - å†å²æ„ä¹‰ä½¿ç”¨ `ğŸ“š` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å½±å“ç¨‹åº¦ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

        # å½±å“è¯„ä¼°æŠ¥å‘Šç« èŠ‚
        elif report_type == "impact":
            if chapter_name == "å½±å“åŒºåŸŸè¯„ä¼°":
                return f"""åŸºäºå†å²æ•°æ®ç”Ÿæˆå°é£å½±å“è¯„ä¼°æŠ¥å‘Šçš„ç¬¬ä¸€ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## ä¸€ã€å½±å“åŒºåŸŸè¯„ä¼°

---

### 1.1 ğŸŒ ä¸»è¦å½±å“åŒºåŸŸ

> **å—å½±å“çœä»½/åŸå¸‚æ¸…å•**

| çœä»½ | ä¸»è¦åŸå¸‚ | å½±å“ç¨‹åº¦ | å—ç¾äººå£ |
|------|----------|----------|----------|
| XXçœ | XXå¸‚ã€XXå¸‚ | **ä¸¥é‡å½±å“** | XXä¸‡äºº |
| XXçœ | XXå¸‚ã€XXå¸‚ | **è¾ƒé‡å½±å“** | XXä¸‡äºº |
| XXçœ | XXå¸‚ | **ä¸€èˆ¬å½±å“** | XXä¸‡äºº |

**ç»Ÿè®¡æ±‡æ€»**ï¼š
- å—å½±å“çœä»½ï¼š**XXä¸ª**
- å—å½±å“åœ°çº§å¸‚ï¼š**XXä¸ª**
- å—å½±å“å¿åŒºï¼š**XXä¸ª**
- æ€»å—ç¾äººå£ï¼šçº¦**XXä¸‡äºº**

### 1.2 ğŸ“ å½±å“èŒƒå›´è¯„ä¼°

> **ç©ºé—´è¦†ç›–èŒƒå›´**

**èŒƒå›´å‚æ•°**ï¼š
- **å½±å“åŠå¾„**ï¼šçº¦XX~XX km
- **è¦†ç›–é¢ç§¯**ï¼šçº¦**XXä¸‡å¹³æ–¹å…¬é‡Œ**
- **æµ·å²¸çº¿é•¿åº¦**ï¼šçº¦XX km
- **å†…é™†æ·±å…¥**ï¼šæœ€è¿œè¾¾XX km

**å½±å“åŒºåŸŸåˆ†å¸ƒ**ï¼š
- æ²¿æµ·åœ°åŒºï¼šXXä¸ªåŸå¸‚ï¼ˆå XX%ï¼‰
- å†…é™†åœ°åŒºï¼šXXä¸ªåŸå¸‚ï¼ˆå XX%ï¼‰
- å±±åŒºåœ°å¸¦ï¼šXXä¸ªå¿åŒºï¼ˆå XX%ï¼‰

### 1.3 ğŸ• å½±å“æ—¶æ®µåˆ†æ

> **æ—¶é—´è½´è¯¦è§£**

**å…³é”®æ—¶é—´èŠ‚ç‚¹**ï¼š

1. **å½±å“å¼€å§‹**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mm
    - é¦–ä¸ªé¢„è­¦å‘å¸ƒæ—¶é—´
    - å¤–å›´äº‘ç³»å¼€å§‹å½±å“

2. **å½±å“é«˜å³°**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mmè‡³DDæ—¥ HH:mm
    - é£é›¨æœ€å¼ºæ—¶æ®µ
    - æŒç»­æ—¶é—´ï¼šXXå°æ—¶

3. **å½±å“ç»“æŸ**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mm
    - è­¦æŠ¥è§£é™¤æ—¶é—´
    - å¤©æ°”è½¬å¥½æ—¶é—´

**æ€»æŒç»­æ—¶é—´**ï¼š**Xå¤©Xå°æ—¶**ï¼ˆä»é¢„è­¦å‘å¸ƒåˆ°è§£é™¤ï¼‰

### 1.4 ğŸ“Š å½±å“ç¨‹åº¦åˆ†çº§

> **åˆ†çº§è¯„ä¼°æ ‡å‡†**

| å½±å“ç­‰çº§ | åŒºåŸŸæ•°é‡ | ä¸»è¦ç‰¹å¾ | ä»£è¡¨åŸå¸‚ |
|----------|----------|----------|----------|
| **ä¸¥é‡å½±å“** | XXä¸ª | é£é€Ÿ>XX m/sï¼Œé™é›¨>XXX mm | XXå¸‚ã€XXå¸‚ |
| **è¾ƒé‡å½±å“** | XXä¸ª | é£é€ŸXX~XX m/sï¼Œé™é›¨XX~XXX mm | XXå¸‚ã€XXå¸‚ |
| **ä¸€èˆ¬å½±å“** | XXä¸ª | é£é€Ÿ<XX m/sï¼Œé™é›¨<XX mm | XXå¸‚ã€XXå¸‚ |

**åˆ†çº§ä¾æ®**ï¼š
- é£é€Ÿå¼ºåº¦ï¼šXX%æƒé‡
- é™é›¨é‡ï¼šXX%æƒé‡
- æŒç»­æ—¶é—´ï¼šXX%æƒé‡
- ç»æµæŸå¤±ï¼šXX%æƒé‡

### 1.5 ğŸ—ºï¸ åœ°ç†ç‰¹å¾åˆ†æ

**åœ°å½¢åœ°è²Œå½±å“**ï¼š

1. **æ²¿æµ·å¹³åŸåŒº**
    - ç‰¹å¾ï¼šåœ°åŠ¿ä½å¹³ï¼Œæ˜“å—é£æš´æ½®å½±å“
    - ä¸»è¦é£é™©ï¼šæµ·æ°´å€’çŒã€å†…æ¶

2. **ä¸˜é™µå±±åœ°åŒº**
    - ç‰¹å¾ï¼šåœ°å½¢å¤æ‚ï¼Œé™é›¨é›†ä¸­
    - ä¸»è¦é£é™©ï¼šå±±æ´ªã€æ³¥çŸ³æµã€æ»‘å¡

3. **æ²³ç½‘å¯†é›†åŒº**
    - ç‰¹å¾ï¼šæ°´ç³»å‘è¾¾ï¼Œæ’æ°´å‹åŠ›å¤§
    - ä¸»è¦é£é™©ï¼šæ´ªæ¶ã€å ¤é˜²æºƒå†³

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šæœ¬æ¬¡å°é£ä¸»è¦å½±å“XXåœ°åŒºï¼Œè¦†ç›–XXä¸‡å¹³æ–¹å…¬é‡Œï¼ŒæŒç»­XXå¤©ï¼ŒXXåœ°åŒºå—ç¾æœ€ä¸¥é‡ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - æ—¶é—´ï¼š`YYYYå¹´MMæœˆDDæ—¥ HH:mm`
   - è·ç¦»ï¼š`XX km`æˆ–èŒƒå›´`XX~XX km`
   - é¢ç§¯ï¼š`XXä¸‡å¹³æ–¹å…¬é‡Œ`
   - äººå£ï¼š`XXä¸‡äºº`
   - æŒç»­æ—¶é—´ï¼š`Xå¤©Xå°æ—¶`
   - ç™¾åˆ†æ¯”ï¼š`XX%`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - åœ°åŒºä¿¡æ¯ä½¿ç”¨ `ğŸŒ` å›¾æ ‡
   - èŒƒå›´ä¿¡æ¯ä½¿ç”¨ `ğŸ“` å›¾æ ‡
   - æ—¶é—´ä¿¡æ¯ä½¿ç”¨ `ğŸ•` å›¾æ ‡
   - æ•°æ®ç»Ÿè®¡ä½¿ç”¨ `ğŸ“Š` å›¾æ ‡
   - åœ°å›¾ä¿¡æ¯ä½¿ç”¨ `ğŸ—ºï¸` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å½±å“ç¨‹åº¦ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "ç¾å®³é£é™©åˆ†æ":
                return f"""åŸºäºå†å²æ•°æ®ç”Ÿæˆå°é£å½±å“è¯„ä¼°æŠ¥å‘Šçš„ç¬¬äºŒç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## äºŒã€ç¾å®³é£é™©åˆ†æ

---

### 2.1 ğŸ’¨ é£ç¾é£é™©

> **é£åŠ›ç ´åè¯„ä¼°**

| é£åŠ›ç­‰çº§ | é£é€ŸèŒƒå›´ | å½±å“åŒºåŸŸ | ä¸»è¦å±å®³ |
|----------|----------|----------|----------|
| 12çº§ä»¥ä¸Š | >XX m/s | XXå¸‚XXåŒº | æˆ¿å±‹ä¸¥é‡æŸæ¯ã€æ ‘æœ¨è¿æ ¹æ‹”èµ· |
| 10-11çº§ | XX~XX m/s | XXå¸‚XXåŒº | æˆ¿å±‹å—æŸã€å¹¿å‘Šç‰Œå€’å¡Œ |
| 8-9çº§ | XX~XX m/s | XXå¸‚XXåŒº | æ ‘ææŠ˜æ–­ã€é—¨çª—æŸå |

**é£ç¾ç‰¹å¾**ï¼š
- **æœ€å¤§é£é€Ÿ**ï¼š**XX m/sï¼ˆXXçº§ï¼‰**
- **æœ€å¤§é˜µé£**ï¼š**XX m/sï¼ˆXXçº§ï¼‰**
- **æŒç»­æ—¶é—´**ï¼šXXå°æ—¶ï¼ˆâ‰¥8çº§é£ï¼‰
- **å½±å“åŠå¾„**ï¼šçº¦XX km

**âš ï¸ é«˜é£é™©åŒºåŸŸ**ï¼šæ²¿æµ·åœ°åŒºã€é«˜å±‚å»ºç­‘ã€ä¸´æ—¶å»ºç­‘ç‰©

### 2.2 ğŸŒ§ï¸ é›¨ç¾é£é™©

> **é™é›¨ç¾å®³è¯„ä¼°**

**é™é›¨ç»Ÿè®¡**ï¼š
- **æœ€å¤§é™é›¨é‡**ï¼š**XXX mm**ï¼ˆXXå¸‚XXåŒºï¼‰
- **ç´¯è®¡é™é›¨**ï¼šXX~XXX mm
- **é™é›¨å¼ºåº¦**ï¼šæœ€å¤§XX mm/h
- **æŒç»­æ—¶é—´**ï¼šXXå°æ—¶

**é™é›¨åˆ†å¸ƒ**ï¼š

| é™é›¨ç­‰çº§ | é™é›¨é‡ | å½±å“åŒºåŸŸ | ä¸»è¦é£é™© |
|----------|--------|----------|----------|
| ç‰¹å¤§æš´é›¨ | >250 mm | XXå¸‚ | ä¸¥é‡å†…æ¶ã€å±±æ´ª |
| å¤§æš´é›¨ | 100~250 mm | XXå¸‚ | åŸå¸‚å†…æ¶ã€å†œç”°å—æ·¹ |
| æš´é›¨ | 50~100 mm | XXå¸‚ | å±€éƒ¨ç§¯æ°´ |

**âš ï¸ é«˜é£é™©åŒºåŸŸ**ï¼šä½æ´¼åœ°å¸¦ã€å±±åŒºã€æ²³ç½‘å¯†é›†åŒº

### 2.3 ğŸŒŠ æ½®ç¾é£é™©

> **é£æš´æ½®ç¾å®³è¯„ä¼°**

**æ½®ä½æ•°æ®**ï¼š
- **æœ€å¤§é£æš´æ½®**ï¼š**X.Xç±³**ï¼ˆè¶…è­¦æˆ’X.Xç±³ï¼‰
- **æœ€å¤§æµ·æµª**ï¼š**X~Xç±³**
- **å½±å“æµ·å²¸çº¿**ï¼šçº¦XX km
- **æŒç»­æ—¶é—´**ï¼šXXå°æ—¶

**å—å½±å“åŒºåŸŸ**ï¼š

| åŒºåŸŸ | æ½®ä½é«˜åº¦ | è¶…è­¦æˆ’å€¼ | ä¸»è¦é£é™© |
|------|----------|----------|----------|
| XXæ¸¯ | X.Xç±³ | +X.Xç±³ | æµ·æ°´å€’çŒã€ç å¤´å—æŸ |
| XXæ¹¾ | X.Xç±³ | +X.Xç±³ | æµ·å ¤æ¼«é¡¶ã€å…»æ®–å—æŸ |
| XXæ»© | X.Xç±³ | +X.Xç±³ | æµ·å²¸ä¾µèš€ |

**âš ï¸ é«˜é£é™©åŒºåŸŸ**ï¼šæ²¿æµ·ä½åœ°ã€æ¸¯å£ç å¤´ã€æµ·æ°´å…»æ®–åŒº

### 2.4 âš ï¸ æ¬¡ç”Ÿç¾å®³é£é™©

> **è¡ç”Ÿç¾å®³è¯„ä¼°**

**1. å±±æ´ªæ³¥çŸ³æµ**
- **é«˜é£é™©åŒº**ï¼šXXä¸ªå±±åŒºå¿
- **é£é™©ç­‰çº§**ï¼š**é«˜é£é™©**
- **ä¸»è¦è¯±å› **ï¼šå¼ºé™é›¨+é™¡å¡åœ°å½¢
- **æ½œåœ¨å¨èƒ**ï¼šXXä¸ªæ‘åº„ã€XXæ¡é“è·¯

**2. åŸå¸‚å†…æ¶**
- **é«˜é£é™©åŒº**ï¼šXXä¸ªåŸå¸‚ä½æ´¼åŒº
- **é£é™©ç­‰çº§**ï¼š**é«˜é£é™©**
- **ä¸»è¦è¯±å› **ï¼šçŸ­æ—¶å¼ºé™é›¨+æ’æ°´ä¸ç•…
- **æ½œåœ¨å¨èƒ**ï¼šXXæ¡é“è·¯ã€XXä¸ªåœ°ä¸‹ç©ºé—´

**3. åœ°è´¨ç¾å®³**
- **é«˜é£é™©åŒº**ï¼šXXå¤„åœ°è´¨ç¾å®³éšæ‚£ç‚¹
- **é£é™©ç­‰çº§**ï¼š**ä¸­é«˜é£é™©**
- **ä¸»è¦ç±»å‹**ï¼šæ»‘å¡ã€å´©å¡Œã€åœ°é¢å¡Œé™·
- **æ½œåœ¨å¨èƒ**ï¼šXXæˆ·å±…æ°‘ã€XXæ¡é“è·¯

### 2.5 ğŸ—ºï¸ ç¾å®³åˆ†å¸ƒç‰¹å¾

**ç©ºé—´åˆ†å¸ƒè§„å¾‹**ï¼š

1. **æ²¿æµ·åœ°åŒº**ï¼šä»¥é£ç¾ã€æ½®ç¾ä¸ºä¸»
2. **å±±åŒºåœ°å¸¦**ï¼šä»¥é›¨ç¾ã€æ¬¡ç”Ÿç¾å®³ä¸ºä¸»
3. **å¹³åŸåœ°åŒº**ï¼šä»¥å†…æ¶ä¸ºä¸»
4. **åŸå¸‚åŒºåŸŸ**ï¼šä»¥å†…æ¶ã€é£ç¾ä¸ºä¸»

### 2.6 ğŸ”— ç¾å®³å åŠ æ•ˆåº”

> **å¤šç¾ç§è€¦åˆåˆ†æ**

**å åŠ æ•ˆåº”è¯„ä¼°**ï¼š

- **é£é›¨å åŠ **ï¼šXXåœ°åŒºåŒæ—¶é­å—XXçº§å¤§é£å’ŒXXX mmé™é›¨ï¼Œç¾å®³ç¨‹åº¦æ”¾å¤§XX%
- **é›¨æ½®å åŠ **ï¼šXXåœ°åŒºé™é›¨ä¸é£æš´æ½®å åŠ ï¼Œå¯¼è‡´æ’æ°´å›°éš¾ï¼Œå†…æ¶åŠ é‡
- **å¤šç¾å åŠ **ï¼šXXåœ°åŒºé£ã€é›¨ã€æ½®ä¸‰ç¾å åŠ ï¼Œå½¢æˆ**æé«˜é£é™©**åŒºåŸŸ

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šæœ¬æ¬¡å°é£ä»¥XXç¾å®³ä¸ºä¸»ï¼ŒXXåœ°åŒºé£é™©æœ€é«˜ï¼Œéœ€é‡ç‚¹é˜²èŒƒXXå åŠ æ•ˆåº”ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - é£é€Ÿï¼š`XX m/sï¼ˆXXçº§ï¼‰`æˆ–èŒƒå›´`XX~XX m/s`
   - é™é›¨é‡ï¼š`XXX mm`æˆ–èŒƒå›´`XX~XXX mm`
   - é™é›¨å¼ºåº¦ï¼š`XX mm/h`
   - é£æš´æ½®ï¼š`X.Xç±³`
   - æµ·æµªé«˜åº¦ï¼š`X~Xç±³`
   - è·ç¦»ï¼š`XX km`
   - ç™¾åˆ†æ¯”ï¼š`XX%`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - é£ç¾ä½¿ç”¨ `ğŸ’¨` å›¾æ ‡
   - é›¨ç¾ä½¿ç”¨ `ğŸŒ§ï¸` å›¾æ ‡
   - æ½®ç¾ä½¿ç”¨ `ğŸŒŠ` å›¾æ ‡
   - æ¬¡ç”Ÿç¾å®³ä½¿ç”¨ `âš ï¸` å›¾æ ‡
   - åˆ†å¸ƒç‰¹å¾ä½¿ç”¨ `ğŸ—ºï¸` å›¾æ ‡
   - å åŠ æ•ˆåº”ä½¿ç”¨ `ğŸ”—` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - é£é™©ç­‰çº§ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "å½±å“ç¨‹åº¦è¯„ä¼°":
                return f"""åŸºäºå†å²æ•°æ®ç”Ÿæˆå°é£å½±å“è¯„ä¼°æŠ¥å‘Šçš„ç¬¬ä¸‰ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## ä¸‰ã€å½±å“ç¨‹åº¦è¯„ä¼°

---

### 3.1 ğŸ‘¥ äººå‘˜å®‰å…¨é£é™©

> **é£é™©åŒºåŸŸåˆ’åˆ†**

| é£é™©ç­‰çº§ | åŒºåŸŸæ•°é‡ | ä¸»è¦ç‰¹å¾ | å—å¨èƒäººå£ |
|----------|----------|----------|------------|
| **é«˜é£é™©** | XXä¸ª | æ²¿æµ·ä½åœ°ã€å±±æ´ªæ˜“å‘åŒº | XXä¸‡äºº |
| **ä¸­é£é™©** | XXä¸ª | åŸå¸‚ä½æ´¼åŒºã€æ²³ç½‘å¯†é›†åŒº | XXä¸‡äºº |
| **ä½é£é™©** | XXä¸ª | å†…é™†å¹³åŸã€åœ°åŠ¿è¾ƒé«˜åŒº | XXä¸‡äºº |

**å®‰å…¨å¨èƒåˆ†æ**ï¼š
- **ç›´æ¥å¨èƒ**ï¼šå¼ºé£ã€æš´é›¨ã€é£æš´æ½®
- **æ¬¡ç”Ÿå¨èƒ**ï¼šå±±æ´ªã€æ³¥çŸ³æµã€æˆ¿å±‹å€’å¡Œ
- **éœ€è½¬ç§»äººå£**ï¼šçº¦**XXä¸‡äºº**
- **ç‰¹æ®Šäººç¾¤**ï¼šè€äººXXä¸‡ã€å„¿ç«¥XXä¸‡ã€ç—…æ‚£XXä¸‡

### 3.2 ğŸ’° è´¢äº§æŸå¤±é£é™©

> **ç»æµæŸå¤±é¢„ä¼°**

**æ€»ä½“æŸå¤±è¯„ä¼°**ï¼š
- **é¢„ä¼°æ€»æŸå¤±**ï¼šçº¦**XX~XXäº¿å…ƒ**
- **ç›´æ¥ç»æµæŸå¤±**ï¼šXXäº¿å…ƒï¼ˆå XX%ï¼‰
- **é—´æ¥ç»æµæŸå¤±**ï¼šXXäº¿å…ƒï¼ˆå XX%ï¼‰

**åˆ†ç±»æŸå¤±ç»Ÿè®¡**ï¼š

| æŸå¤±ç±»åˆ« | é¢„ä¼°é‡‘é¢ | å æ¯” | ä¸»è¦é¡¹ç›® |
|----------|----------|------|----------|
| æˆ¿å±‹å»ºç­‘ | XXäº¿å…ƒ | XX% | å±…æ°‘ä½å®…ã€å…¬å…±å»ºç­‘ |
| åŸºç¡€è®¾æ–½ | XXäº¿å…ƒ | XX% | é“è·¯ã€æ¡¥æ¢ã€ç®¡ç½‘ |
| å†œä¸šæŸå¤± | XXäº¿å…ƒ | XX% | å†œä½œç‰©ã€å…»æ®–ä¸š |
| å·¥å•†ä¸š | XXäº¿å…ƒ | XX% | åœå·¥åœäº§ã€è®¾å¤‡æŸå |

### 3.3 âš¡ åŸºç¡€è®¾æ–½å½±å“

> **å…³é”®è®¾æ–½é£é™©è¯„ä¼°**

**1. ç”µåŠ›ç³»ç»Ÿ**
- **å—å½±å“ç”¨æˆ·**ï¼šçº¦XXä¸‡æˆ·
- **é£é™©ç­‰çº§**ï¼š**é«˜é£é™©**
- **ä¸»è¦å¨èƒ**ï¼šè¾“ç”µçº¿è·¯å€’å¡Œã€å˜ç”µç«™è¿›æ°´
- **é¢„è®¡åœç”µæ—¶é•¿**ï¼šXX~XXå°æ—¶

**2. é€šä¿¡ç³»ç»Ÿ**
- **å—å½±å“åŸºç«™**ï¼šçº¦XXä¸ª
- **é£é™©ç­‰çº§**ï¼š**ä¸­é«˜é£é™©**
- **ä¸»è¦å¨èƒ**ï¼šåŸºç«™æ–­ç”µã€å…‰ç¼†æŸå
- **é¢„è®¡ä¸­æ–­æ—¶é•¿**ï¼šXX~XXå°æ—¶

**3. ä¾›æ°´ç³»ç»Ÿ**
- **å—å½±å“äººå£**ï¼šçº¦XXä¸‡äºº
- **é£é™©ç­‰çº§**ï¼š**ä¸­é£é™©**
- **ä¸»è¦å¨èƒ**ï¼šæ°´æºæ±¡æŸ“ã€ç®¡ç½‘ç ´æŸ
- **é¢„è®¡å½±å“æ—¶é•¿**ï¼šXX~XXå¤©

### 3.4 ğŸš— äº¤é€šè¿è¾“å½±å“

> **äº¤é€šç³»ç»Ÿé£é™©è¯„ä¼°**

| äº¤é€šæ–¹å¼ | å½±å“ç¨‹åº¦ | å—å½±å“çº¿è·¯ | é¢„è®¡ä¸­æ–­æ—¶é•¿ |
|----------|----------|------------|--------------|
| **å…¬è·¯** | **ä¸¥é‡** | XXæ¡é«˜é€Ÿã€XXæ¡å›½é“ | XX~XXå°æ—¶ |
| **é“è·¯** | **è¾ƒé‡** | XXæ¡çº¿è·¯ | XX~XXå°æ—¶ |
| **èˆªç©º** | **ä¸¥é‡** | XXä¸ªæœºåœº | XX~XXå°æ—¶ |
| **æ°´è¿** | **ä¸¥é‡** | XXä¸ªæ¸¯å£ | XX~XXå¤© |

**äº¤é€šç®¡åˆ¶æªæ–½**ï¼š
- é«˜é€Ÿå…¬è·¯å°é—­ï¼šXXæ¡
- é“è·¯åœè¿ï¼šXXè¶Ÿ
- èˆªç­å–æ¶ˆï¼šçº¦XXæ¶æ¬¡
- æ¸¯å£åœèˆªï¼šXXä¸ª

### 3.5 ğŸŒ¾ å†œä¸šå½±å“

> **å†œä¸šæŸå¤±è¯„ä¼°**

**å†œä½œç‰©å½±å“**ï¼š
- **å—ç¾é¢ç§¯**ï¼šçº¦**XXä¸‡äº©**
- **ç»æ”¶é¢ç§¯**ï¼šçº¦**XXä¸‡äº©**
- **ä¸»è¦ä½œç‰©**ï¼šæ°´ç¨»XXä¸‡äº©ã€è”¬èœXXä¸‡äº©ã€æœæ ‘XXä¸‡äº©
- **é¢„ä¼°æŸå¤±**ï¼šçº¦**XXäº¿å…ƒ**

**æ¸”ä¸šå½±å“**ï¼š
- **å—æŸå…»æ®–é¢ç§¯**ï¼šçº¦XXä¸‡äº©
- **å—æŸæ¸”èˆ¹**ï¼šçº¦XXè‰˜
- **é¢„ä¼°æŸå¤±**ï¼šçº¦XXäº¿å…ƒ

**ç•œç‰§ä¸šå½±å“**ï¼š
- **å—å¨èƒå…»æ®–åœº**ï¼šXXä¸ª
- **éœ€è½¬ç§»ç‰²ç•œ**ï¼šçº¦XXä¸‡å¤´/åª
- **é¢„ä¼°æŸå¤±**ï¼šçº¦XXäº¿å…ƒ

### 3.6 ğŸ­ å·¥å•†ä¸šå½±å“

> **å·¥å•†ä¸šæŸå¤±è¯„ä¼°**

**å·¥ä¸šå½±å“**ï¼š
- **åœå·¥ä¼ä¸š**ï¼šçº¦**XXå®¶**
- **å½±å“äº§å€¼**ï¼šçº¦**XXäº¿å…ƒ**
- **ä¸»è¦è¡Œä¸š**ï¼šåˆ¶é€ ä¸šã€åŒ–å·¥ã€ç”µå­ç­‰
- **é¢„è®¡åœå·¥æ—¶é•¿**ï¼šXX~XXå¤©

**å•†ä¸šå½±å“**ï¼š
- **åœä¸šå•†æˆ·**ï¼šçº¦XXå®¶
- **å½±å“è¥ä¸šé¢**ï¼šçº¦XXäº¿å…ƒ
- **ä¸»è¦ä¸šæ€**ï¼šé›¶å”®ã€é¤é¥®ã€æ—…æ¸¸ç­‰
- **é¢„è®¡åœä¸šæ—¶é•¿**ï¼šXX~XXå¤©

**ğŸ“Œ å…³é”®ç»“è®º**ï¼šæœ¬æ¬¡å°é£é¢„è®¡é€ æˆæ€»æŸå¤±XX~XXäº¿å…ƒï¼ŒXXé¢†åŸŸå—å½±å“æœ€ä¸¥é‡ï¼Œéœ€é‡ç‚¹å…³æ³¨XXé£é™©ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - é£é™©ç­‰çº§ï¼š`**é«˜é£é™©**`ã€`**ä¸­é£é™©**`ã€`**ä½é£é™©**`
   - ç»æµæŸå¤±ï¼š`XXäº¿å…ƒ`æˆ–èŒƒå›´`XX~XXäº¿å…ƒ`
   - äººå£ï¼š`XXä¸‡äºº`
   - é¢ç§¯ï¼š`XXä¸‡äº©`
   - æ•°é‡ï¼š`XXå®¶`ã€`XXä¸ª`ã€`XXè‰˜`
   - æ—¶é•¿ï¼š`XX~XXå°æ—¶`æˆ–`XX~XXå¤©`
   - ç™¾åˆ†æ¯”ï¼š`XX%`

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - äººå‘˜å®‰å…¨ä½¿ç”¨ `ğŸ‘¥` å›¾æ ‡
   - ç»æµæŸå¤±ä½¿ç”¨ `ğŸ’°` å›¾æ ‡
   - åŸºç¡€è®¾æ–½ä½¿ç”¨ `âš¡` å›¾æ ‡
   - äº¤é€šè¿è¾“ä½¿ç”¨ `ğŸš—` å›¾æ ‡
   - å†œä¸šå½±å“ä½¿ç”¨ `ğŸŒ¾` å›¾æ ‡
   - å·¥å•†ä¸šä½¿ç”¨ `ğŸ­` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - é£é™©ç­‰çº§ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®æ•°æ®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

            elif chapter_name == "é˜²ç¾å‡ç¾å»ºè®®":
                return f"""åŸºäºå†å²æ•°æ®ç”Ÿæˆå°é£å½±å“è¯„ä¼°æŠ¥å‘Šçš„ç¬¬å››ç« èŠ‚ï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²æ•°æ®ã€‘
{json.dumps(data, ensure_ascii=False, indent=2)}

ã€ç« èŠ‚è¦æ±‚ã€‘
## å››ã€é˜²ç¾å‡ç¾å»ºè®®

---

### 4.1 ğŸš¨ äººå‘˜è½¬ç§»å»ºè®®

> **è½¬ç§»å®‰ç½®æ–¹æ¡ˆ**

**1. è½¬ç§»æ—¶é—´çª—å£**
- **é¢„è­¦å‘å¸ƒ**ï¼šå°é£ç™»é™†å‰XX~XXå°æ—¶
- **è½¬ç§»å¯åŠ¨**ï¼šå°é£ç™»é™†å‰XX~XXå°æ—¶
- **è½¬ç§»å®Œæˆ**ï¼šå°é£ç™»é™†å‰XXå°æ—¶
- **âš ï¸ å…³é”®æ—¶æ®µ**ï¼šYYYYå¹´MMæœˆDDæ—¥ HH:mmå‰å¿…é¡»å®Œæˆ

**2. è½¬ç§»è·¯çº¿è§„åˆ’**
- **æ²¿æµ·åœ°åŒº**ï¼šå‘å†…é™†XX kmä»¥ä¸Šè½¬ç§»
- **å±±åŒºåœ°å¸¦**ï¼šå‘åœ°åŠ¿è¾ƒé«˜ã€åœ°è´¨ç¨³å®šåŒºè½¬ç§»
- **ä½æ´¼åœ°åŒº**ï¼šå‘åœ°åŠ¿é«˜å¤„è½¬ç§»
- **é¿å¼€åŒºåŸŸ**ï¼šæ²³é“ã€æ°´åº“ä¸‹æ¸¸ã€åœ°è´¨ç¾å®³éšæ‚£ç‚¹

**3. å®‰ç½®ç‚¹é€‰æ‹©**
- **ä¸´æ—¶å®‰ç½®ç‚¹**ï¼šå­¦æ ¡ã€ä½“è‚²é¦†ã€ç¤¾åŒºä¸­å¿ƒç­‰ï¼ˆXXå¤„ï¼‰
- **å®¹çº³èƒ½åŠ›**ï¼šå¯å®‰ç½®XXä¸‡äºº
- **åŸºæœ¬è®¾æ–½**ï¼šé£Ÿå“ã€é¥®æ°´ã€åŒ»ç–—ã€é€šä¿¡
- **ç®¡ç†è¦æ±‚**ï¼šä¸“äººå€¼å®ˆã€å®šæ—¶å·¡æŸ¥

**4. ç‰¹æ®Šäººç¾¤å®‰ç½®**
- **è€å¹´äºº**ï¼šä¼˜å…ˆè½¬ç§»ï¼Œä¸“äººç…§é¡¾
- **å„¿ç«¥**ï¼šé›†ä¸­å®‰ç½®ï¼Œç¡®ä¿å®‰å…¨
- **ç—…æ‚£**ï¼šåŒ»ç–—ä¿éšœï¼Œè¯å“å……è¶³
- **å­•å¦‡**ï¼šç‰¹åˆ«å…³æ³¨ï¼ŒåŒ»æŠ¤éšè¡Œ

**5. è½¬ç§»ç‰©èµ„å‡†å¤‡**
- ä¸ªäººè¯ä»¶ã€ç°é‡‘
- 3å¤©ä»¥ä¸Šé£Ÿå“ã€é¥®ç”¨æ°´
- å¸¸ç”¨è¯å“ã€æ€¥æ•‘ç”¨å“
- æ‰‹ç”µç­’ã€æ”¶éŸ³æœºã€å……ç”µå®
- æ¢æ´—è¡£ç‰©ã€é›¨å…·

### 4.2 ğŸ“¦ ç‰©èµ„å‡†å¤‡å»ºè®®

> **åº”æ€¥ç‰©èµ„å‚¨å¤‡æ¸…å•**

**1. åº”æ€¥ç‰©èµ„æ¸…å•**

| ç‰©èµ„ç±»åˆ« | ä¸»è¦ç‰©å“ | å‚¨å¤‡é‡å»ºè®® | ä¼˜å…ˆçº§ |
|----------|----------|------------|--------|
| **é£Ÿå“é¥®æ°´** | æ–¹ä¾¿é£Ÿå“ã€ç“¶è£…æ°´ | 3~5å¤©ç”¨é‡ | â­â­â­ |
| **åŒ»ç–—ç”¨å“** | æ€¥æ•‘åŒ…ã€å¸¸ç”¨è¯ | å®¶åº­è£… | â­â­â­ |
| **ç…§æ˜é€šä¿¡** | æ‰‹ç”µç­’ã€æ”¶éŸ³æœº | æ¯æˆ·1å¥— | â­â­â­ |
| **é˜²æŠ¤ç”¨å“** | é›¨è¡£ã€é›¨é´ã€å£ç½© | æ¯äºº1å¥— | â­â­ |
| **å·¥å…·è®¾å¤‡** | ç»³ç´¢ã€é“é”¹ã€é”¤å­ | æ¯æˆ·1å¥— | â­â­ |

**2. å‚¨å¤‡é‡å»ºè®®**
- **å®¶åº­å‚¨å¤‡**ï¼šæ»¡è¶³3~5å¤©åŸºæœ¬éœ€æ±‚
- **ç¤¾åŒºå‚¨å¤‡**ï¼šæ»¡è¶³XX%å±…æ°‘3å¤©éœ€æ±‚
- **æ”¿åºœå‚¨å¤‡**ï¼šæ»¡è¶³XXä¸‡äºº7å¤©éœ€æ±‚

**3. å‚¨å­˜ä½ç½®**
- **å®¶åº­**ï¼šæ˜“å–ä½ç½®ï¼Œé˜²æ°´é˜²æ½®
- **ç¤¾åŒº**ï¼šå®‰å…¨åœ°å¸¦ï¼Œä¾¿äºåˆ†å‘
- **æ”¿åºœ**ï¼šæˆ˜ç•¥å‚¨å¤‡åº“ï¼Œåˆ†æ•£å¸ƒå±€

**4. ç‰©èµ„è°ƒé…æ–¹æ¡ˆ**
- **è°ƒé…åŸåˆ™**ï¼šå°±è¿‘è°ƒé…ã€å¿«é€Ÿå“åº”
- **è¿è¾“è·¯çº¿**ï¼šå¤šæ¡å¤‡ç”¨è·¯çº¿
- **é…é€æ–¹å¼**ï¼šæ”¿åºœç»Ÿä¸€é…é€+ç¤¾åŒºè‡ªå–
- **ä¼˜å…ˆé¡ºåº**ï¼šé‡ç¾åŒº>ä¸€èˆ¬ç¾åŒº>è½»ç¾åŒº

**5. ç‰©èµ„è¡¥å……æœºåˆ¶**
- **æ—¥å¸¸è¡¥å……**ï¼šå®šæœŸæ£€æŸ¥ï¼ŒåŠæ—¶æ›´æ–°
- **åº”æ€¥è¡¥å……**ï¼šå¯åŠ¨åº”æ€¥é‡‡è´­ç¨‹åº
- **ç¤¾ä¼šæèµ **ï¼šå¼€é€šæèµ æ¸ é“ï¼Œç»Ÿä¸€ç®¡ç†

### 4.3 ğŸ¯ åº”æ€¥å“åº”å»ºè®®

> **åº”æ€¥å“åº”æœºåˆ¶**

**1. åº”æ€¥é¢„æ¡ˆå¯åŠ¨**

| å“åº”çº§åˆ« | å¯åŠ¨æ¡ä»¶ | å“åº”æªæ–½ | è´£ä»»å•ä½ |
|----------|----------|----------|----------|
| **â… çº§å“åº”** | è¶…å¼ºå°é£ | å…¨é¢åŠ¨å‘˜ã€æœ€é«˜æŒ‡æŒ¥ | çœçº§æ”¿åºœ |
| **â…¡çº§å“åº”** | å¼ºå°é£ | é‡ç‚¹é˜²å¾¡ã€åŠ å¼ºå€¼å®ˆ | å¸‚çº§æ”¿åºœ |
| **â…¢çº§å“åº”** | å°é£ | å¯†åˆ‡ç›‘è§†ã€åšå¥½å‡†å¤‡ | å¿çº§æ”¿åºœ |
| **â…£çº§å“åº”** | çƒ­å¸¦é£æš´ | å…³æ³¨åŠ¨æ€ã€é¢„è­¦å‘å¸ƒ | ä¹¡é•‡æ”¿åºœ |

**2. éƒ¨é—¨åè°ƒæœºåˆ¶**
- **æŒ‡æŒ¥éƒ¨**ï¼šç»Ÿä¸€æŒ‡æŒ¥ã€ç»¼åˆåè°ƒ
- **æ°”è±¡éƒ¨é—¨**ï¼šç›‘æµ‹é¢„è­¦ã€ä¿¡æ¯å‘å¸ƒ
- **åº”æ€¥éƒ¨é—¨**ï¼šæ•‘æ´æ•‘ç¾ã€ç‰©èµ„è°ƒé…
- **å…¬å®‰éƒ¨é—¨**ï¼šäº¤é€šç®¡åˆ¶ã€æ²»å®‰ç»´æŠ¤
- **å«ç”Ÿéƒ¨é—¨**ï¼šåŒ»ç–—æ•‘æ²»ã€å«ç”Ÿé˜²ç–«
- **ç”µåŠ›é€šä¿¡**ï¼šæŠ¢ä¿®ä¿éšœã€åº”æ€¥é€šä¿¡

**3. ä¿¡æ¯å‘å¸ƒæ¸ é“**
- **å®˜æ–¹åª’ä½“**ï¼šç”µè§†ã€å¹¿æ’­ã€æŠ¥çº¸
- **æ–°åª’ä½“**ï¼šå¾®ä¿¡ã€å¾®åšã€APP
- **åº”æ€¥å¹¿æ’­**ï¼šæ‘æ‘å“ã€ç¤¾åŒºå¹¿æ’­
- **çŸ­ä¿¡æ¨é€**ï¼šæ‰‹æœºçŸ­ä¿¡ã€é¢„è­¦ä¿¡æ¯
- **âš ï¸ å‘å¸ƒé¢‘ç‡**ï¼šæ¯XXå°æ—¶æ›´æ–°ä¸€æ¬¡

**4. åº”æ€¥é˜Ÿä¼éƒ¨ç½²**
- **ä¸“ä¸šæ•‘æ´é˜Ÿ**ï¼šæ¶ˆé˜²ã€æ­¦è­¦ã€æ°‘å…µï¼ˆXXæ”¯é˜Ÿä¼ï¼‰
- **åŒ»ç–—é˜Ÿ**ï¼šåŒ»ç–—æ•‘æŠ¤ã€å¿ƒç†ç–å¯¼ï¼ˆXXæ”¯é˜Ÿä¼ï¼‰
- **æŠ¢é™©é˜Ÿ**ï¼šç”µåŠ›ã€é€šä¿¡ã€äº¤é€šï¼ˆXXæ”¯é˜Ÿä¼ï¼‰
- **å¿—æ„¿è€…é˜Ÿ**ï¼šåå‹¤ä¿éšœã€ç§©åºç»´æŠ¤ï¼ˆXXäººï¼‰

**5. åº”æ€¥æ¼”ç»ƒè¦æ±‚**
- **æ¼”ç»ƒé¢‘æ¬¡**ï¼šæ¯å¹´XXæ¬¡
- **æ¼”ç»ƒå†…å®¹**ï¼šäººå‘˜è½¬ç§»ã€ç‰©èµ„è°ƒé…ã€åº”æ€¥æ•‘æ´
- **æ¼”ç»ƒèŒƒå›´**ï¼šé‡ç‚¹åŒºåŸŸå…¨è¦†ç›–
- **æ¼”ç»ƒè¯„ä¼°**ï¼šåŠæ—¶æ€»ç»“ã€æŒç»­æ”¹è¿›

**ğŸ“Œ å…³é”®å»ºè®®**ï¼šå»ºè®®XXåœ°åŒºå¯åŠ¨**XXçº§å“åº”**ï¼Œé‡ç‚¹åšå¥½XXå·¥ä½œï¼Œç¡®ä¿äººæ°‘ç”Ÿå‘½è´¢äº§å®‰å…¨ã€‚

---

ã€Markdownæ ¼å¼è§„èŒƒã€‘
1. **è§†è§‰å±‚æ¬¡**ï¼š
   - ç« èŠ‚å¼€å¤´ä½¿ç”¨åˆ†éš”çº¿ `---`
   - é‡è¦æ•°æ®ä½¿ç”¨å¼•ç”¨å— `>`
   - å¯¹æ¯”æ•°æ®ä½¿ç”¨è¡¨æ ¼å±•ç¤º

2. **åˆ—è¡¨æ ¼å¼**ï¼š
   - æœ‰åºæ­¥éª¤ä½¿ç”¨æ•°å­—åˆ—è¡¨ `1. 2. 3.`
   - å¹¶åˆ—è¦ç‚¹ä½¿ç”¨æ— åºåˆ—è¡¨ `-`
   - åµŒå¥—åˆ—è¡¨ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›

3. **æ•°æ®æ ¼å¼è§„èŒƒ**ï¼š
   - æ—¶é—´ï¼š`YYYYå¹´MMæœˆDDæ—¥ HH:mm`æˆ–`XX~XXå°æ—¶`
   - è·ç¦»ï¼š`XX km`
   - æ•°é‡ï¼š`XXå¤„`ã€`XXä¸‡äºº`ã€`XXæ”¯é˜Ÿä¼`
   - å“åº”çº§åˆ«ï¼š`**â… çº§å“åº”**`ã€`**â…¡çº§å“åº”**`ç­‰
   - ä¼˜å…ˆçº§ï¼š`â­â­â­`ï¼ˆé«˜ï¼‰ã€`â­â­`ï¼ˆä¸­ï¼‰ã€`â­`ï¼ˆä½ï¼‰

4. **è§†è§‰å¼ºè°ƒå…ƒç´ **ï¼š
   - äººå‘˜è½¬ç§»ä½¿ç”¨ `ğŸš¨` å›¾æ ‡
   - ç‰©èµ„å‡†å¤‡ä½¿ç”¨ `ğŸ“¦` å›¾æ ‡
   - åº”æ€¥å“åº”ä½¿ç”¨ `ğŸ¯` å›¾æ ‡
   - è­¦å‘Šä¿¡æ¯ä½¿ç”¨ `âš ï¸` å›¾æ ‡
   - é‡è¦æç¤ºä½¿ç”¨ `ğŸ“Œ` å›¾æ ‡

5. **å¼ºè°ƒæ ¼å¼**ï¼š
   - å“åº”çº§åˆ«ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®å»ºè®®ä½¿ç”¨ `**åŠ ç²—**`
   - å…³é”®ç»“è®ºå•ç‹¬æˆæ®µå¹¶åŠ ç²—

ã€è¾“å‡ºè¦æ±‚ã€‘
- æœ¬ç« èŠ‚å­—æ•°ä¸å°‘äº**250å­—**
- ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡º
- ç›´æ¥è¾“å‡ºç« èŠ‚å†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…
- ç¡®ä¿è¡¨æ ¼ã€åˆ—è¡¨ã€å›¾æ ‡æ­£ç¡®æ˜¾ç¤º"""

        return ""
    # ç« èŠ‚å¹¶å‘ç”Ÿæˆæ‰©å±• - ç»“æŸ

    async def generate_typhoon_report(
        self,
        typhoon_id: str,
        typhoon_name: str,
        report_type: str = "comprehensive",
        historical_data: Optional[Dict] = None,
        prediction_data: Optional[Dict] = None
    ) -> Dict:
        """
        ä½¿ç”¨DeepSeekç”Ÿæˆå°é£åˆ†ææŠ¥å‘Šï¼ˆæ”¯æŒä¸‰ç§æŠ¥å‘Šç±»å‹ï¼‰

        Args:
            typhoon_id: å°é£ç¼–å·
            typhoon_name: å°é£åç§°
            report_type: æŠ¥å‘Šç±»å‹ï¼ˆcomprehensive/prediction/impactï¼‰
            historical_data: å†å²è·¯å¾„æ•°æ®ï¼ˆç”¨äºç»¼åˆåˆ†æå’Œå½±å“è¯„ä¼°ï¼‰
            prediction_data: é¢„æµ‹æ•°æ®ï¼ˆç”¨äºé¢„æµ‹æŠ¥å‘Šï¼‰

        Returns:
            Dict: æŠ¥å‘Šç”Ÿæˆç»“æœï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                - success: bool - æ˜¯å¦æˆåŠŸ
                - report_content: str - æŠ¥å‘Šå†…å®¹
                - model_used: str - ä½¿ç”¨çš„æ¨¡å‹
                - error: str - é”™è¯¯ä¿¡æ¯ï¼ˆä»…åœ¨å¤±è´¥æ—¶ï¼‰
        """
        logger.info(f"å¼€å§‹ç”Ÿæˆå°é£æŠ¥å‘Š - å°é£ID: {typhoon_id}, åç§°: {typhoon_name}, ç±»å‹: {report_type}")

        try:
            # ç« èŠ‚å¹¶å‘ç”Ÿæˆæ‰©å±• - ç»¼åˆåˆ†ææŠ¥å‘Šå’Œå½±å“è¯„ä¼°æŠ¥å‘Šä½¿ç”¨ç« èŠ‚å¹¶å‘ç”Ÿæˆ
            if report_type in ["comprehensive", "impact"]:
                # å®šä¹‰ç« èŠ‚åˆ—è¡¨
                if report_type == "comprehensive":
                    chapters = ["å°é£ç”Ÿå‘½å‘¨æœŸæ¦‚å†µ", "è·¯å¾„ç‰¹å¾åˆ†æ", "å¼ºåº¦æ¼”å˜åˆ†æ", "å†å²å½±å“è¯„ä¼°"]
                    data = historical_data or {}
                else:  # impact
                    chapters = ["å½±å“åŒºåŸŸè¯„ä¼°", "ç¾å®³é£é™©åˆ†æ", "å½±å“ç¨‹åº¦è¯„ä¼°", "é˜²ç¾å‡ç¾å»ºè®®"]
                    data = historical_data or {}

                logger.info(f"å¼€å§‹å¹¶å‘ç”Ÿæˆ{len(chapters)}ä¸ªç« èŠ‚")

                # æ„å»ºæ‰€æœ‰ç« èŠ‚çš„æç¤ºè¯
                chapter_prompts = []
                for chapter_name in chapters:
                    prompt = self._build_chapter_prompt(
                        report_type=report_type,
                        chapter_name=chapter_name,
                        typhoon_id=typhoon_id,
                        typhoon_name=typhoon_name,
                        data=data
                    )
                    chapter_prompts.append((chapter_name, prompt))

                # å¹¶å‘ç”Ÿæˆæ‰€æœ‰ç« èŠ‚
                chapter_tasks = [
                    self._generate_single_chapter(chapter_name, prompt)
                    for chapter_name, prompt in chapter_prompts
                ]

                chapter_results = await asyncio.gather(*chapter_tasks, return_exceptions=True)

                # åˆå¹¶ç« èŠ‚ç»“æœ
                report_parts = []
                failed_chapters = []

                for idx, (chapter_name, result) in enumerate(zip(chapters, chapter_results)):
                    if isinstance(result, Exception):
                        # å¼‚å¸¸æƒ…å†µ
                        error_msg = str(result)
                        logger.error(f"ç« èŠ‚ç”Ÿæˆå¼‚å¸¸ - ç« èŠ‚åç§°: {chapter_name}, å¼‚å¸¸: {error_msg}")
                        report_parts.append(f"\n\nã€è¯¥ç« èŠ‚ç”Ÿæˆå¤±è´¥ï¼š{error_msg}ã€‘\n\n")
                        failed_chapters.append(f"{chapter_name}({error_msg})")
                    elif result.get("success"):
                        # æˆåŠŸç”Ÿæˆ
                        report_parts.append(result.get("content", ""))
                    else:
                        # ç”Ÿæˆå¤±è´¥
                        error_msg = result.get("error", "æœªçŸ¥é”™è¯¯")
                        logger.error(f"ç« èŠ‚ç”Ÿæˆå¤±è´¥ - ç« èŠ‚åç§°: {chapter_name}, é”™è¯¯: {error_msg}")
                        report_parts.append(f"\n\nã€è¯¥ç« èŠ‚ç”Ÿæˆå¤±è´¥ï¼š{error_msg}ã€‘\n\n")
                        failed_chapters.append(f"{chapter_name}({error_msg})")

                # åˆå¹¶å®Œæ•´æŠ¥å‘Š
                report_content = "\n\n".join(report_parts)

                logger.info(f"DeepSeekæŠ¥å‘Šç”Ÿæˆå®Œæˆ - æ€»å†…å®¹é•¿åº¦: {len(report_content)}, å¤±è´¥ç« èŠ‚æ•°: {len(failed_chapters)}")

                # æ„å»ºè¿”å›ç»“æœ
                result_dict = {
                    "success": True,
                    "report_content": report_content.strip(),
                    "model_used": self.model
                }

                # å¦‚æœæœ‰å¤±è´¥ç« èŠ‚ï¼Œæ·»åŠ é”™è¯¯ä¿¡æ¯
                if failed_chapters:
                    result_dict["error"] = f"éƒ¨åˆ†ç« èŠ‚ç”Ÿæˆå¤±è´¥: {', '.join(failed_chapters)}"

                return result_dict

            # é¢„æµ‹æŠ¥å‘Šä¿æŒåŸæœ‰é€»è¾‘
            elif report_type == "prediction":
                prompt = self._build_prediction_prompt(typhoon_id, typhoon_name, prediction_data or {})

                payload = {
                    "model": self.model,
                    "messages": [
                        {
                            "role": "system",
                            "content": "ä½ æ˜¯æ°”è±¡åˆ†æä¸“å®¶ï¼Œæ“…é•¿ç”Ÿæˆè¯¦å°½ä¸“ä¸šçš„å°é£æŠ¥å‘Šã€‚è¯·ä½¿ç”¨Markdownæ ¼å¼è¾“å‡ºï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆ##ï¼‰ã€åˆ—è¡¨ï¼ˆ-ï¼‰ã€åŠ ç²—ï¼ˆ**ï¼‰ç­‰æ ¼å¼ã€‚"
                        },
                        {
                            "role": "user",
                            "content": prompt
                        }
                    ],
                    "stream": False,
                    "temperature": 0.5,
                    "max_tokens": self.max_tokens,
                    "frequency_penalty": 0.3,
                    "response_format": {"type": "text"}
                }

                headers = {
                    "Authorization": f"Bearer {self.api_key}",
                    "Content-Type": "application/json"
                }

                # ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚
                result = await self._make_api_request(payload, headers)

                # æå–ç”Ÿæˆçš„æŠ¥å‘Šå†…å®¹
                report_content = result.get("choices", [{}])[0].get("message", {}).get("content", "")

                logger.info(f"DeepSeekæŠ¥å‘Šç”ŸæˆæˆåŠŸ - å†…å®¹é•¿åº¦: {len(report_content)}")

                return {
                    "success": True,
                    "report_content": report_content.strip(),
                    "model_used": self.model
                }
            else:
                raise ValueError(f"ä¸æ”¯æŒçš„æŠ¥å‘Šç±»å‹: {report_type}")

        except Exception as e:
            logger.error(f"DeepSeekæŠ¥å‘Šç”Ÿæˆå¤±è´¥: {e}")
            logger.error(f"é”™è¯¯ç±»å‹: {type(e).__name__}")
            logger.error(f"é”™è¯¯è¯¦æƒ…: {str(e)}")

            return {
                "success": False,
                "error": f"DeepSeekæœåŠ¡è°ƒç”¨å¤±è´¥: {str(e)}",
                "report_content": ""
            }

    def _build_comprehensive_prompt(self, typhoon_id: str, typhoon_name: str, historical_data: Dict) -> str:
        """æ„å»ºç»¼åˆåˆ†ææŠ¥å‘Šæç¤ºè¯"""
        return f"""åŸºäºå†å²è·¯å¾„æ•°æ®ç”Ÿæˆå°é£ç»¼åˆåˆ†ææŠ¥å‘Šï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²è·¯å¾„æ•°æ®ã€‘
{json.dumps(historical_data, ensure_ascii=False, indent=2)}

ã€æŠ¥å‘Šæ ¼å¼è¦æ±‚ã€‘
## ä¸€ã€å°é£ç”Ÿå‘½å‘¨æœŸæ¦‚å†µ
   - ç”Ÿæˆæ—¶é—´ã€æ¶ˆæ•£æ—¶é—´ã€æŒç»­æ—¶é•¿
   - å½±å“åŒºåŸŸèŒƒå›´
   - å°é£ç­‰çº§æ¼”å˜å†ç¨‹
   - ç”Ÿå‘½å‘¨æœŸå„é˜¶æ®µç‰¹å¾

## äºŒã€è·¯å¾„ç‰¹å¾åˆ†æ
   - ç§»åŠ¨è·¯å¾„è¯¦ç»†æè¿°ï¼ˆèµ·ç‚¹â†’è½¬æŠ˜ç‚¹â†’ç»ˆç‚¹ï¼‰
   - ç§»åŠ¨é€Ÿåº¦å˜åŒ–è§„å¾‹åŠåŸå› åˆ†æ
   - è·¯å¾„è½¬æŠ˜ç‚¹åˆ†æï¼ˆæ—¶é—´ã€ä½ç½®ã€åŸå› ï¼‰
   - è·¯å¾„å¼‚å¸¸ç‰¹å¾ï¼ˆå¦‚æœ‰ï¼‰
   - ä¸å†å²å°é£è·¯å¾„å¯¹æ¯”

## ä¸‰ã€å¼ºåº¦æ¼”å˜åˆ†æ
   - æœ€å¤§å¼ºåº¦åŠå‡ºç°æ—¶é—´ã€åœ°ç‚¹
   - å¼ºåº¦å˜åŒ–è¶‹åŠ¿ï¼ˆå¢å¼º/å‡å¼±é˜¶æ®µè¯¦ç»†åˆ†æï¼‰
   - ä¸­å¿ƒæ°”å‹å˜åŒ–è§„å¾‹åŠå½±å“å› ç´ 
   - æœ€å¤§é£é€Ÿå˜åŒ–è§„å¾‹åŠå½±å“å› ç´ 
   - å¼ºåº¦å˜åŒ–ä¸ç¯å¢ƒå› ç´ å…³ç³»

## å››ã€å†å²å½±å“è¯„ä¼°
   - ä¸»è¦å½±å“åœ°åŒºåŠå½±å“ç¨‹åº¦
   - ç¾å®³ç±»å‹ä¸ç¨‹åº¦ï¼ˆé£ç¾ã€é›¨ç¾ã€æ½®ç¾ï¼‰
   - ç»æµæŸå¤±è¯„ä¼°ï¼ˆå¦‚æœ‰æ•°æ®ï¼‰
   - äººå‘˜ä¼¤äº¡æƒ…å†µï¼ˆå¦‚æœ‰æ•°æ®ï¼‰
   - å†å²æ„ä¹‰ä¸å‚è€ƒä»·å€¼

ã€è¾“å‡ºè¦æ±‚ã€‘
- **ä½¿ç”¨Markdownæ ¼å¼è¾“å‡º**ï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆ##ï¼‰ã€åˆ—è¡¨ï¼ˆ-ï¼‰ã€åŠ ç²—ï¼ˆ**ï¼‰ç­‰
- æŠ¥å‘Šæ€»å­—æ•°ä¸å°‘äº**1000å­—**
- æ¯ä¸ªç« èŠ‚è‡³å°‘åŒ…å«**4-6ä¸ªåˆ†æè¦ç‚¹**
- å…³é”®æ•°æ®ä½¿ç”¨**åŠ ç²—**çªå‡ºæ˜¾ç¤º
- è¯­è¨€ä¸“ä¸šè¯¦å°½ï¼Œé€»è¾‘æ¸…æ™°
- ç›´æ¥è¾“å‡ºæŠ¥å‘Šå†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…"""

    def _build_prediction_prompt(self, typhoon_id: str, typhoon_name: str, prediction_data: Dict) -> str:
        """æ„å»ºé¢„æµ‹æŠ¥å‘Šæç¤ºè¯"""
        return f"""åŸºäºé¢„æµ‹æ•°æ®ç”Ÿæˆå°é£é¢„æµ‹æŠ¥å‘Šï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€é¢„æµ‹æ•°æ®ã€‘
{json.dumps(prediction_data, ensure_ascii=False, indent=2)}

ã€æŠ¥å‘Šæ ¼å¼è¦æ±‚ã€‘
## ä¸€ã€å½“å‰çŠ¶æ€
   - å½“å‰ä½ç½®ï¼ˆç»çº¬åº¦ã€åœ°ç†ä½ç½®æè¿°ï¼‰
   - å½“å‰å¼ºåº¦ï¼ˆé£é€Ÿã€æ°”å‹ã€ç­‰çº§ï¼‰
   - ç§»åŠ¨æ–¹å‘ä¸é€Ÿåº¦
   - å½“å‰å½±å“èŒƒå›´

## äºŒã€æœªæ¥è·¯å¾„é¢„æµ‹
   - æœªæ¥6å°æ—¶è·¯å¾„è¶‹åŠ¿åŠå…³é”®ç‚¹ä½
   - æœªæ¥12-24å°æ—¶è·¯å¾„é¢„æµ‹åŠå¯èƒ½å½±å“åŒºåŸŸ
   - æœªæ¥48-72å°æ—¶è·¯å¾„é¢„æµ‹åŠç™»é™†å¯èƒ½æ€§
   - é¢„è®¡ç™»é™†ç‚¹ä¸æ—¶é—´ï¼ˆå¦‚é€‚ç”¨ï¼ŒåŒ…æ‹¬ç½®ä¿¡åº¦ï¼‰
   - è·¯å¾„ä¸ç¡®å®šæ€§åˆ†æ
   - å¯èƒ½çš„è·¯å¾„è°ƒæ•´å› ç´ 

## ä¸‰ã€å¼ºåº¦å˜åŒ–é¢„æµ‹
   - æœªæ¥24å°æ—¶é£é€Ÿå˜åŒ–è¶‹åŠ¿åŠå³°å€¼é¢„æµ‹
   - æœªæ¥48-72å°æ—¶é£é€Ÿå˜åŒ–è¶‹åŠ¿
   - æ°”å‹å˜åŒ–è¶‹åŠ¿åŠæœ€ä½å€¼é¢„æµ‹
   - å¼ºåº¦ç­‰çº§å˜åŒ–é¢„æµ‹ï¼ˆçƒ­å¸¦ä½å‹â†’å°é£â†’å¼ºå°é£ç­‰ï¼‰
   - å¼ºåº¦å˜åŒ–çš„å½±å“å› ç´ åˆ†æ
   - å¼ºåº¦é¢„æµ‹çš„ä¸ç¡®å®šæ€§è¯´æ˜

## å››ã€é¢„è­¦å»ºè®®
   - é‡ç‚¹å…³æ³¨åŒºåŸŸåŠé¢„è­¦ç­‰çº§
   - å„åŒºåŸŸé¢„è­¦æ—¶é—´çª—å£
   - é˜²èŒƒé‡ç‚¹ï¼ˆé£ã€é›¨ã€æ½®ï¼‰
   - åº”æ€¥å‡†å¤‡å»ºè®®ï¼ˆ3-5æ¡ï¼‰
   - ç›‘æµ‹å…³æ³¨è¦ç‚¹

ã€è¾“å‡ºè¦æ±‚ã€‘
- **ä½¿ç”¨Markdownæ ¼å¼è¾“å‡º**ï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆ##ï¼‰ã€åˆ—è¡¨ï¼ˆ-ï¼‰ã€åŠ ç²—ï¼ˆ**ï¼‰ç­‰
- æŠ¥å‘Šæ€»å­—æ•°ä¸å°‘äº**1000å­—**
- æ¯ä¸ªç« èŠ‚è‡³å°‘åŒ…å«**4-6ä¸ªåˆ†æè¦ç‚¹**
- å…³é”®é¢„æµ‹æ•°æ®ä½¿ç”¨**åŠ ç²—**çªå‡ºæ˜¾ç¤º
- è¯­è¨€ä¸“ä¸šè¯¦å°½ï¼Œé€»è¾‘æ¸…æ™°
- ç›´æ¥è¾“å‡ºæŠ¥å‘Šå†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…"""

    def _build_impact_prompt(self, typhoon_id: str, typhoon_name: str, historical_data: Dict) -> str:
        """æ„å»ºå½±å“è¯„ä¼°æŠ¥å‘Šæç¤ºè¯"""
        return f"""åŸºäºå†å²æ•°æ®ç”Ÿæˆå°é£å½±å“è¯„ä¼°æŠ¥å‘Šï¼š

ã€å°é£ä¿¡æ¯ã€‘
ç¼–å·ï¼š{typhoon_id} | åç§°ï¼š{typhoon_name}

ã€å†å²æ•°æ®ã€‘
{json.dumps(historical_data, ensure_ascii=False, indent=2)}

ã€æŠ¥å‘Šæ ¼å¼è¦æ±‚ã€‘
## ä¸€ã€å½±å“åŒºåŸŸè¯„ä¼°
   - ä¸»è¦å½±å“çœä»½/åŸå¸‚è¯¦ç»†åˆ—è¡¨
   - å½±å“èŒƒå›´ï¼ˆåŠå¾„ã€é¢ç§¯ä¼°ç®—ï¼‰
   - å½±å“æ—¶æ®µï¼ˆå¼€å§‹æ—¶é—´ã€æŒç»­æ—¶é—´ã€ç»“æŸæ—¶é—´ï¼‰
   - å„åŒºåŸŸå—å½±å“ç¨‹åº¦åˆ†çº§
   - å½±å“åŒºåŸŸåœ°ç†ç‰¹å¾åˆ†æ

## äºŒã€ç¾å®³é£é™©åˆ†æ
   - **é£ç¾é£é™©**ï¼šæœ€å¤§é£é€Ÿã€é£åŠ›ç­‰çº§ã€é˜µé£æƒ…å†µ
   - **é›¨ç¾é£é™©**ï¼šç´¯è®¡é™é›¨é‡ã€é™é›¨å¼ºåº¦ã€æŒç»­æ—¶é—´
   - **æ½®ç¾é£é™©**ï¼šé£æš´æ½®é«˜åº¦ã€æµ·æµªé«˜åº¦ã€æ½®ä½é¢„æµ‹
   - **æ¬¡ç”Ÿç¾å®³é£é™©**ï¼šå±±æ´ªã€æ³¥çŸ³æµã€åŸå¸‚å†…æ¶ç­‰
   - å„ç±»ç¾å®³çš„ç©ºé—´åˆ†å¸ƒç‰¹å¾
   - ç¾å®³å åŠ æ•ˆåº”åˆ†æ

## ä¸‰ã€å½±å“ç¨‹åº¦è¯„ä¼°
   - **äººå‘˜å®‰å…¨é£é™©ç­‰çº§**ï¼šé«˜/ä¸­/ä½é£é™©åŒºåŸŸåˆ’åˆ†
   - **è´¢äº§æŸå¤±é£é™©ç­‰çº§**ï¼šç»æµæŸå¤±é¢„ä¼°
   - **åŸºç¡€è®¾æ–½å½±å“è¯„ä¼°**ï¼šç”µåŠ›ã€é€šä¿¡ã€ä¾›æ°´ç­‰
   - **äº¤é€šè¿è¾“å½±å“è¯„ä¼°**ï¼šå…¬è·¯ã€é“è·¯ã€èˆªç©ºã€æ°´è¿
   - **å†œä¸šå½±å“è¯„ä¼°**ï¼šå†œä½œç‰©ã€æ¸”ä¸šæŸå¤±
   - **å·¥å•†ä¸šå½±å“è¯„ä¼°**ï¼šåœå·¥åœäº§æƒ…å†µ

## å››ã€é˜²ç¾å‡ç¾å»ºè®®
   - **äººå‘˜è½¬ç§»å»ºè®®**ï¼ˆ5-7æ¡å…·ä½“æªæ–½ï¼‰
     - è½¬ç§»æ—¶é—´çª—å£
     - è½¬ç§»è·¯çº¿è§„åˆ’
     - å®‰ç½®ç‚¹é€‰æ‹©
   - **ç‰©èµ„å‡†å¤‡å»ºè®®**ï¼ˆ5-7æ¡å…·ä½“æªæ–½ï¼‰
     - åº”æ€¥ç‰©èµ„æ¸…å•
     - å‚¨å¤‡é‡å»ºè®®
     - å‚¨å­˜ä½ç½®
   - **åº”æ€¥å“åº”å»ºè®®**ï¼ˆ5-7æ¡å…·ä½“æªæ–½ï¼‰
     - åº”æ€¥é¢„æ¡ˆå¯åŠ¨
     - éƒ¨é—¨åè°ƒæœºåˆ¶
     - ä¿¡æ¯å‘å¸ƒæ¸ é“

ã€è¾“å‡ºè¦æ±‚ã€‘
- **ä½¿ç”¨Markdownæ ¼å¼è¾“å‡º**ï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆ##ï¼‰ã€åˆ—è¡¨ï¼ˆ-ï¼‰ã€åŠ ç²—ï¼ˆ**ï¼‰ç­‰
- æŠ¥å‘Šæ€»å­—æ•°ä¸å°‘äº**1000å­—**
- æ¯ä¸ªç« èŠ‚è‡³å°‘åŒ…å«**5-7ä¸ªåˆ†æè¦ç‚¹**
- é£é™©ç­‰çº§ä½¿ç”¨**åŠ ç²—**æ˜ç¡®æ ‡æ³¨
- è¯­è¨€ä¸“ä¸šè¯¦å°½ï¼Œé€»è¾‘æ¸…æ™°
- ç›´æ¥è¾“å‡ºæŠ¥å‘Šå†…å®¹ï¼Œä¸ä½¿ç”¨ä»£ç å—åŒ…è£…"""


# åˆ›å»ºå…¨å±€æœåŠ¡å®ä¾‹
deepseek_service = DeepSeekService()
